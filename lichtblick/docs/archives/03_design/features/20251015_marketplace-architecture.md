# ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹æ©Ÿèƒ½ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

**ä½œæˆæ—¥**: 2025å¹´10æœˆ15æ—¥
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ15æ—¥
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿè£…å®Œäº†

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³)
3. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
5. [å®Ÿè£…è©³ç´°](#å®Ÿè£…è©³ç´°)
6. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
7. [æ‹¡å¼µæ€§](#æ‹¡å¼µæ€§)

---

## æ¦‚è¦

### ç›®çš„

Lichtblickã®ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹æ©Ÿèƒ½ã¯ã€ä»¥ä¸‹ã®2ã¤ã®ä¸»è¦ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™:

1. **Extension Marketplace**: ã‚«ã‚¹ã‚¿ãƒ æ‹¡å¼µæ©Ÿèƒ½ã®é…ä¿¡ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. **Layout Marketplace**: äº‹å‰å®šç¾©ã•ã‚ŒãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®é…ä¿¡ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### è¨­è¨ˆåŸå‰‡

- **å˜ä¸€è²¬ä»»åŸå‰‡**: å„Providerã¯æ˜ç¢ºã«åˆ†é›¢ã•ã‚ŒãŸè²¬å‹™ã‚’æŒã¤
- **ä¸€è²«æ€§**: Extensionã¨Layoutã§åŒã˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: SHA256ãƒãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹æ”¹ã–ã‚“æ¤œå‡º
- **ä¿å®ˆæ€§**: æ©Ÿèƒ½ã®æ‰€åœ¨ãŒæ˜ç¢ºã§ã€å°†æ¥çš„ãªæ‹¡å¼µãŒå®¹æ˜“

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

### 2å±¤Provideræ§‹é€ 

ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹æ©Ÿèƒ½ã¯ã€ä»¥ä¸‹ã®2å±¤æ§‹é€ ã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UI Components                      â”‚
â”‚    (LayoutMarketplaceSettings, ExtensionMarketplaceSettings)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ useLayoutMarketplace()
                         â”‚ useLayoutCatalog()
                         â”‚ useExtensionMarketplace()
                         â”‚ useExtensionCatalog()
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Marketplace Layer (Layer 1)             â”‚
â”‚     ãƒ‡ãƒ¼ã‚¿å–å¾—å°‚ç”¨ - ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ãƒ¼ã‚¹APIã¨ã®é€šä¿¡     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LayoutMarketplaceProvider | ExtensionMarketplaceProvider â”‚
â”‚  - getAvailableLayouts()   | - getAvailableExtensions()  â”‚
â”‚  - searchLayouts()         | - searchExtensions()        â”‚
â”‚  - getLayoutDetail()       | - getExtensionDetail()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ JSON API
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Catalog Layer (Layer 2)                    â”‚
â”‚  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ç®¡ç†å°‚ç”¨ - ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ç®¡ç†ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç† â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   LayoutCatalogProvider    | ExtensionCatalogProvider    â”‚
â”‚   - downloadLayout()       | - downloadExtension()       â”‚
â”‚   - verifyHash()           | - verifyHash()              â”‚
â”‚   - installLayout()        | - installExtension()        â”‚
â”‚   - uninstallLayout()      | - uninstallExtension()      â”‚
â”‚   - getInstalled()         | - getInstalled()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Local Storage / State                   â”‚
â”‚         (èµ·æºæƒ…å ±ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ )              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è²¬å‹™ã®åˆ†é›¢

| Layer                 | è²¬å‹™                                                                                               | ä¾å­˜é–¢ä¿‚                                                                                  |
| --------------------- | -------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| **Marketplace Layer** | - ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—<br>- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°<br>- ã‚¢ã‚¤ãƒ†ãƒ è©³ç´°ã®æä¾›                 | - å¤–éƒ¨API<br>- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯                                                               |
| **Catalog Layer**     | - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»æ¤œè¨¼<br>- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«<br>- ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ç®¡ç†<br>- èµ·æºæƒ…å ±ã®è¨˜éŒ² | - LayoutManager/ExtensionLoader<br>- LocalStorage<br>- Marketplace Layer (ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã¿) |

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

### 1. Layout Marketplace

#### 1.1 Context & Provider

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**:

```
packages/suite-base/src/
â”œâ”€â”€ context/
â”‚   â”œâ”€â”€ LayoutMarketplaceContext.ts    # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
â”‚   â””â”€â”€ LayoutCatalogContext.ts        # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
â””â”€â”€ providers/
    â”œâ”€â”€ LayoutMarketplaceProvider.tsx  # ãƒ‡ãƒ¼ã‚¿å–å¾—
    â””â”€â”€ LayoutCatalogProvider.tsx      # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç®¡ç†
```

**LayoutMarketplaceContext**:

```typescript
export interface LayoutMarketplace {
  getAvailableLayouts(): Promise<LayoutMarketplaceDetail[]>;
  searchLayouts(query: string): Promise<LayoutMarketplaceDetail[]>;
  getLayoutDetail(id: string): Promise<LayoutMarketplaceDetail | undefined>;
}

export type LayoutMarketplaceDetail = {
  id: string;
  name: string;
  description: string;
  author?: string;
  tags?: string[];
  thumbnail?: string;
  layout: string; // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®URL
  sha256sum?: string; // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ç”¨
  license?: string;
  homepage?: string;
};
```

**LayoutCatalogContext**:

```typescript
export interface LayoutCatalog {
  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»æ¤œè¨¼
  downloadLayoutFromMarketplace(detail: LayoutMarketplaceDetail): Promise<LayoutData>;
  verifyLayoutHash(data: LayoutData, expectedHash: string): Promise<boolean>;
  validateLayoutData(data: LayoutData): Promise<boolean>;

  // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ç®¡ç†
  installLayoutFromMarketplace(
    detail: LayoutMarketplaceDetail,
    name?: string,
  ): Promise<InstallLayoutResult>;
  uninstallMarketplaceLayout(id: LayoutID): Promise<void>;
  getInstalledMarketplaceLayouts(): Promise<Layout[]>;

  // èµ·æºç®¡ç†
  getMarketplaceOrigin(layoutId: LayoutID): Promise<MarketplaceOrigin | undefined>;
  markAsMarketplaceLayout(layoutId: LayoutID, origin: MarketplaceOrigin): Promise<void>;
}

export type InstallLayoutResult = {
  success: boolean;
  layout?: Layout;
  error?: unknown;
};

export type MarketplaceOrigin = {
  marketplaceId: string;
  installedAt: string;
  originalUrl: string;
  author: string;
};
```

#### 1.2 å®Ÿè£…ã®ç‰¹å¾´

**LayoutMarketplaceProvider** (ã‚·ãƒ³ãƒ—ãƒ«):

- ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹APIã‹ã‚‰ã®JSONå–å¾—
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- çŠ¶æ…‹ã‚’æŒãŸãªã„ç´”ç²‹ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒå±¤

**LayoutCatalogProvider** (çµ±åˆç®¡ç†):

- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (fetchçµŒç”±)
- SHA256ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ»å†…å®¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- é‡è¤‡ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æ¤œå‡º
- èµ·æºæƒ…å ±ã®LocalStorageç®¡ç†
- LayoutManagerã¨ã®é€£æº

### 2. Extension Marketplace

#### 2.1 Context & Provider

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**:

```
packages/suite-base/src/
â”œâ”€â”€ context/
â”‚   â”œâ”€â”€ ExtensionMarketplaceContext.tsx  # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
â”‚   â””â”€â”€ ExtensionCatalogContext.ts       # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
â””â”€â”€ providers/
    â”œâ”€â”€ ExtensionMarketplaceProvider.tsx # ãƒ‡ãƒ¼ã‚¿å–å¾—
    â””â”€â”€ ExtensionCatalogProvider.tsx     # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç®¡ç†
```

**ExtensionMarketplaceContext**:

```typescript
export interface ExtensionMarketplace {
  getAvailableExtensions(): Promise<ExtensionMarketplaceDetail[]>;
  getMarkdown(url: string): Promise<string>;
}

export type ExtensionMarketplaceDetail = {
  id: string;
  name: string;
  qualifiedName: string;
  description: string;
  publisher: string;
  homepage: string;
  license: string;
  version: string;
  keywords: string[];
  foxe: string; // æ‹¡å¼µæ©Ÿèƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã®URL
  readme: string; // READMEã®URL
  changelog: string; // CHANGELOGã®URL
  sha256sum?: string; // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ç”¨
};
```

**ExtensionCatalogContext**:

```typescript
export interface ExtensionCatalog {
  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»æ¤œè¨¼
  downloadExtension(detail: ExtensionMarketplaceDetail): Promise<Uint8Array>;

  // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ç®¡ç†
  installExtension(foxeFileData: Uint8Array, detail: ExtensionMarketplaceDetail): Promise<string>;
  uninstallExtension(id: string): Promise<void>;

  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
  getInstalledVersion(namespace: string, extensionName: string): string | undefined;

  // æ›´æ–°ç®¡ç†
  checkForUpdates(): Promise<void>;
}
```

### 3. å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 3.1 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
packages/suite-base/src/components/shared/Marketplace/
â”œâ”€â”€ card/
â”‚   â””â”€â”€ MarketplaceCard/
â”‚       â”œâ”€â”€ MarketplaceCard.tsx        # ã‚¢ã‚¤ãƒ†ãƒ ã‚«ãƒ¼ãƒ‰
â”‚       â””â”€â”€ MarketplaceCard.style.ts
â”œâ”€â”€ layouts/
â”‚   â”œâ”€â”€ MarketplaceGrid/
â”‚   â”‚   â”œâ”€â”€ MarketplaceGrid.tsx        # ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â””â”€â”€ MarketplaceGrid.style.ts
â”‚   â”œâ”€â”€ MarketplaceHeader/
â”‚   â”‚   â”œâ”€â”€ MarketplaceHeader.tsx      # ãƒ˜ãƒƒãƒ€ãƒ¼
â”‚   â”‚   â”œâ”€â”€ MarketplaceHeader.style.ts
â”‚   â”‚   â””â”€â”€ MarketplaceTitleSection/
â”‚   â”‚       â”œâ”€â”€ MarketplaceTitleSection.tsx
â”‚   â”‚       â””â”€â”€ MarketplaceTitleSection.style.ts
â”‚   â””â”€â”€ MarketplaceDetailBase/
â”‚       â”œâ”€â”€ MarketplaceDetailBase.tsx  # è©³ç´°ãƒšãƒ¼ã‚¸ãƒ™ãƒ¼ã‚¹
â”‚       â””â”€â”€ MarketplaceDetailBase.style.ts
â””â”€â”€ hooks/
    â””â”€â”€ useMarketplaceSearch.ts        # çµ±ä¸€ã•ã‚ŒãŸæ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯
```

#### 3.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**MarketplaceCard**:

- ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤º
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŠ¶æ…‹ã®è¡¨ç¤º
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ (Install/Uninstall)
- ã‚¿ã‚°è¡¨ç¤º
- ä½œæˆè€…æƒ…å ±

**MarketplaceGrid**:

- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- å‹•çš„ãªã‚«ãƒ©ãƒ èª¿æ•´
- LazyLoadã®ã‚µãƒãƒ¼ãƒˆ

**MarketplaceHeader**:

- æ¤œç´¢ãƒãƒ¼
- ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ (All/Installed)
- ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½

**MarketplaceDetailBase**:

- è©³ç´°æƒ…å ±ã®è¡¨ç¤º
- README/CHANGELOGã®è¡¨ç¤º
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º

### 4. ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

#### 4.1 useMarketplaceSearch

**ç›®çš„**: Extensionã¨Layoutã§çµ±ä¸€ã•ã‚ŒãŸæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’æä¾›

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/suite-base/src/components/shared/Marketplace/hooks/useMarketplaceSearch.ts`

**æ©Ÿèƒ½**:

- ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ (åå‰ã€èª¬æ˜ã€ã‚¿ã‚°ã€ä½œæˆè€…)
- ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° (AND/OR mode)
- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ (All/Installed)
- æ¤œç´¢ã‚µã‚¸ã‚§ã‚¹ãƒˆ
- ã‚¿ã‚°çµ±è¨ˆæƒ…å ±
- é«˜åº¦ãªæ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³

**ä½¿ç”¨ä¾‹**:

```typescript
const {
  searchQuery,
  setSearchQuery,
  selectedTags,
  setSelectedTags,
  activeTab,
  setActiveTab,
  filteredItems,
  tagStats,
  searchSuggestions,
} = useMarketplaceSearch({
  items: layouts,
  enableSuggestions: true,
  maxSuggestions: 15,
});
```

#### 4.2 useInstallingLayoutsState

**ç›®çš„**: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãƒãƒƒãƒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨é€²æ—ç®¡ç†

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/suite-base/src/hooks/useInstallingLayoutsState.tsx`

**æ©Ÿèƒ½**:

- è¤‡æ•°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ä¸€æ‹¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- é€²æ—çŠ¶æ…‹ã®è¿½è·¡
- æˆåŠŸãƒ»å¤±æ•—é€šçŸ¥
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 4.3 useMarketplaceActions

**ç›®çš„**: ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹æ“ä½œã®å…±é€šãƒ­ã‚¸ãƒƒã‚¯

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/suite-base/src/hooks/marketplace/useMarketplaceActions.ts`

**æ©Ÿèƒ½**:

- éåŒæœŸæ“ä½œã®å®Ÿè¡Œ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
- ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³                                              â”‚
â”‚    LayoutMarketplaceSettings.tsx                                 â”‚
â”‚    - "Install" ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ•ãƒƒã‚¯                                              â”‚
â”‚    useInstallingLayoutsState.tsx                                 â”‚
â”‚    - installLayouts([{detail, name}])                           â”‚
â”‚    - é€²æ—ç®¡ç†ã®é–‹å§‹                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ã‚«ã‚¿ãƒ­ã‚°å±¤                                                      â”‚
â”‚    LayoutCatalogProvider                                         â”‚
â”‚    â”œâ”€ installLayoutFromMarketplace(detail, name)                â”‚
â”‚    â”œâ”€ é‡è¤‡ãƒã‚§ãƒƒã‚¯                                                â”‚
â”‚    â”œâ”€ downloadLayoutFromMarketplace(detail)                     â”‚
â”‚    â”‚   â”œâ”€ fetch(detail.layout)                                  â”‚
â”‚    â”‚   â”œâ”€ validateLayoutDataStructure()                         â”‚
â”‚    â”‚   â””â”€ verifyLayoutHash() (if sha256sum available)          â”‚
â”‚    â”œâ”€ validateLayoutData()                                      â”‚
â”‚    â”œâ”€ layoutManager.saveNewLayout()                             â”‚
â”‚    â””â”€ markAsMarketplaceLayout() - LocalStorage                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. é€šçŸ¥ãƒ»UIæ›´æ–°                                                    â”‚
â”‚    - Success/Error ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼                                   â”‚
â”‚    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿çŠ¶æ…‹ã®æ›´æ–°                                     â”‚
â”‚    - ãƒªã‚¹ãƒˆå†èª­ã¿è¾¼ã¿                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ‹¡å¼µæ©Ÿèƒ½ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³                                              â”‚
â”‚    ExtensionMarketplace.tsx                                      â”‚
â”‚    - "Install" ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ã‚«ã‚¿ãƒ­ã‚°å±¤                                                      â”‚
â”‚    ExtensionCatalogProvider                                      â”‚
â”‚    â”œâ”€ downloadExtension(detail)                                 â”‚
â”‚    â”‚   â”œâ”€ fetch(detail.foxe)                                    â”‚
â”‚    â”‚   â””â”€ verifyHash() (if sha256sum available)                â”‚
â”‚    â”œâ”€ installExtension(foxeFileData, detail)                    â”‚
â”‚    â”‚   â”œâ”€ ExtensionLoader.installExtension()                    â”‚
â”‚    â”‚   â””â”€ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®è¨˜éŒ²                                    â”‚
â”‚    â””â”€ èµ·æºæƒ…å ±ã®è¨˜éŒ² - LocalStorage                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. é€šçŸ¥ãƒ»UIæ›´æ–°                                                    â”‚
â”‚    - Success/Error ãƒ€ã‚¤ã‚¢ãƒ­ã‚°                                     â”‚
â”‚    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿çŠ¶æ…‹ã®æ›´æ–°                                     â”‚
â”‚    - ãƒªã‚¹ãƒˆå†èª­ã¿è¾¼ã¿                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›                                                    â”‚
â”‚    MarketplaceHeader                                             â”‚
â”‚    - æ¤œç´¢ã‚¯ã‚¨ãƒªå…¥åŠ›                                               â”‚
â”‚    - ã‚¿ã‚°é¸æŠ                                                     â”‚
â”‚    - ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯                                                    â”‚
â”‚    useMarketplaceSearch                                          â”‚
â”‚    â”œâ”€ ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢                                                â”‚
â”‚    â”‚   â”œâ”€ name.includes(query)                                  â”‚
â”‚    â”‚   â”œâ”€ description.includes(query)                           â”‚
â”‚    â”‚   â”œâ”€ tags.includes(query)                                  â”‚
â”‚    â”‚   â””â”€ author.includes(query)                                â”‚
â”‚    â”œâ”€ ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°                                          â”‚
â”‚    â”‚   â”œâ”€ AND mode: ã™ã¹ã¦ã®ã‚¿ã‚°ãŒä¸€è‡´                            â”‚
â”‚    â”‚   â””â”€ OR mode: ã„ãšã‚Œã‹ã®ã‚¿ã‚°ãŒä¸€è‡´                           â”‚
â”‚    â””â”€ ã‚¿ãƒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°                                          â”‚
â”‚        â”œâ”€ All: ã™ã¹ã¦è¡¨ç¤º                                         â”‚
â”‚        â””â”€ Installed: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®ã¿                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. çµæœè¡¨ç¤º                                                        â”‚
â”‚    MarketplaceGrid                                               â”‚
â”‚    - filteredItems ã‚’ MarketplaceCard ã§è¡¨ç¤º                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Ÿè£…è©³ç´°

### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…

#### SHA256ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼

**ç›®çš„**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æ”¹ã–ã‚“æ¤œå‡º

**å®Ÿè£…**:

```typescript
async function calculateSHA256(data: string): Promise<string> {
  const encoder = new TextEncoder();
  const dataBuffer = encoder.encode(data);
  const hashBuffer = await crypto.subtle.digest("SHA-256", dataBuffer);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
}

async function verifyLayoutHash(data: LayoutData, expectedHash: string): Promise<boolean> {
  const dataString = JSON.stringify(data);
  if (dataString == undefined) {
    throw new Error("Failed to serialize layout data");
  }
  const actualHash = await calculateSHA256(dataString);
  return actualHash === expectedHash.toLowerCase();
}
```

**ä½¿ç”¨ç®‡æ‰€**:

- LayoutCatalogProvider: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚
- ExtensionCatalogProvider: æ‹¡å¼µæ©Ÿèƒ½ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚

#### ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ æ¤œè¨¼**:

```typescript
function validateLayoutDataStructure(data: unknown): data is LayoutData {
  if (typeof data !== "object" || data == undefined) {
    return false;
  }

  const layoutData = data as Record<string, unknown>;

  return (
    layoutData.configById != undefined &&
    typeof layoutData.configById === "object" &&
    layoutData.globalVariables != undefined &&
    typeof layoutData.globalVariables === "object" &&
    layoutData.playbackConfig != undefined &&
    typeof layoutData.playbackConfig === "object" &&
    layoutData.userNodes != undefined &&
    typeof layoutData.userNodes === "object"
  );
}
```

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‡ãƒ¼ã‚¿ã®å†…å®¹æ¤œè¨¼**:

```typescript
function validateLayoutDataContent(data: LayoutData): boolean {
  try {
    // ãƒ‘ãƒãƒ«è¨­å®šã®æ¤œè¨¼
    for (const [panelId, config] of Object.entries(data.configById)) {
      if (typeof panelId !== "string" || !panelId.trim()) {
        return false;
      }
      if (typeof config !== "object") {
        return false;
      }
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®æ¤œè¨¼
    for (const [varName, varValue] of Object.entries(data.globalVariables)) {
      if (typeof varName !== "string" || !varName.trim()) {
        return false;
      }
      if (
        varValue != undefined &&
        typeof varValue !== "string" &&
        typeof varValue !== "number" &&
        typeof varValue !== "boolean"
      ) {
        return false;
      }
    }

    return true;
  } catch {
    return false;
  }
}
```

### 2. èµ·æºæƒ…å ±ç®¡ç†

**ç›®çš„**: ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã®è¿½è·¡

**LocalStorageã‚­ãƒ¼**:

- Layouts: `lichtblick.layout.marketplace.origins`
- Extensions: `lichtblick.extension.marketplace.origins`

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **:

```typescript
// Layouts
type LayoutOrigins = Record<LayoutID, MarketplaceOrigin>;

type MarketplaceOrigin = {
  marketplaceId: string;
  installedAt: string;
  originalUrl: string;
  author: string;
};

// Extensions
type ExtensionOrigins = Record<ExtensionID, ExtensionMarketplaceOrigin>;

type ExtensionMarketplaceOrigin = {
  marketplaceId: string;
  version: string;
  installedAt: string;
  originalUrl: string;
};
```

**å®Ÿè£…**:

```typescript
// å–å¾—
function getMarketplaceOrigins(): Record<string, MarketplaceOrigin> {
  try {
    const stored = localStorage.getItem(MARKETPLACE_ORIGINS_KEY);
    if (stored) {
      return JSON.parse(stored) as Record<string, MarketplaceOrigin>;
    }
  } catch (error) {
    console.warn("Failed to load marketplace origins:", error);
  }
  return {};
}

// ä¿å­˜
function saveMarketplaceOrigins(origins: Record<string, MarketplaceOrigin>): void {
  try {
    const serialized = JSON.stringify(origins);
    if (serialized != undefined) {
      localStorage.setItem(MARKETPLACE_ORIGINS_KEY, serialized);
    }
  } catch (error) {
    console.warn("Failed to save marketplace origins:", error);
  }
}
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**éšå±¤çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:

```
Layer 1: Provider Level
â”œâ”€ try-catch ã§ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
â”œâ”€ console.error ã§ãƒ­ã‚°è¨˜éŒ²
â””â”€ ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸Šä½ã«ä¼æ’­

Layer 2: Hook Level
â”œâ”€ Providerã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
â”œâ”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰æ›
â””â”€ ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼é€šçŸ¥

Layer 3: Component Level
â”œâ”€ ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®è¡¨ç¤º
â”œâ”€ ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ã®æä¾›
â””â”€ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯UI
```

**å®Ÿè£…ä¾‹**:

```typescript
// Provider Level
const downloadLayoutFromMarketplace = useCallback(
  async (detail: LayoutMarketplaceDetail): Promise<LayoutData> => {
    try {
      const response = await fetch(detail.layout);
      if (!response.ok) {
        throw new Error(`Failed to download layout: ${response.status}`);
      }
      // ...
    } catch (error) {
      console.error(`Error downloading layout ${detail.id}:`, error);
      throw error; // ä¸Šä½ã«ä¼æ’­
    }
  },
  [verifyLayoutHash],
);

// Hook Level
const installLayouts = useCallback(
  async (layoutsData: LayoutInstallData[]): Promise<LayoutInstallResult[]> => {
    // ...
    try {
      const result = await installLayoutFromMarketplace(detail, name);
      if (result.success) {
        enqueueSnackbar("Installation successful", { variant: "success" });
      } else {
        const errorMessage =
          result.error instanceof Error ? result.error.message : "Installation failed";
        enqueueSnackbar(errorMessage, { variant: "error" });
      }
    } catch (error) {
      enqueueSnackbar("Unexpected error occurred", { variant: "error" });
    }
  },
  [installLayoutFromMarketplace, enqueueSnackbar],
);
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. è„…å¨ãƒ¢ãƒ‡ãƒ«

| è„…å¨                 | å¯¾ç­–                   | å®Ÿè£…                                 |
| -------------------- | ---------------------- | ------------------------------------ |
| **ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“**   | SHA256ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼     | `verifyLayoutHash()`, `verifyHash()` |
| **ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ** | ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | `validateLayoutDataStructure()`      |
| **æ‚ªæ„ã®ã‚ã‚‹å†…å®¹**   | å†…å®¹æ¤œè¨¼               | `validateLayoutDataContent()`        |
| **XSSæ”»æ’ƒ**          | ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³     | Reactæ¨™æº–ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ©Ÿèƒ½            |
| **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“** | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¤œè¨¼       | å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯                     |

### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### å…¥åŠ›æ¤œè¨¼

- ã™ã¹ã¦ã®å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼
- å‹å®‰å…¨æ€§ã®ç¢ºä¿
- nullãƒã‚§ãƒƒã‚¯ã®å¾¹åº•

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã¯ãƒ­ã‚°ã®ã¿
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ä¸€èˆ¬çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®éè¡¨ç¤º

#### ãƒ‡ãƒ¼ã‚¿ä¿è­·

- LocalStorageã®æš—å·åŒ–ã¯ä¸è¦ï¼ˆå…¬é–‹æƒ…å ±ã®ã¿ï¼‰
- æ©Ÿå¯†æƒ…å ±ã®ä¿å­˜ã‚’é¿ã‘ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®æœ€å°åŒ–

---

## æ‹¡å¼µæ€§

### 1. æ–°ã—ã„ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã®è¿½åŠ 

**æ‰‹é †**:

1. **Contextã®ä½œæˆ**:

```typescript
// context/NewItemMarketplaceContext.ts
export interface NewItemMarketplace {
  getAvailableItems(): Promise<NewItemMarketplaceDetail[]>;
  searchItems(query: string): Promise<NewItemMarketplaceDetail[]>;
  getItemDetail(id: string): Promise<NewItemMarketplaceDetail | undefined>;
}

// context/NewItemCatalogContext.ts
export interface NewItemCatalog {
  downloadItem(detail: NewItemMarketplaceDetail): Promise<NewItemData>;
  installItem(detail: NewItemMarketplaceDetail): Promise<InstallResult>;
  uninstallItem(id: string): Promise<void>;
}
```

2. **Providerã®å®Ÿè£…**:

```typescript
// providers/NewItemMarketplaceProvider.tsx
export default function NewItemMarketplaceProvider({ children }) {
  const getAvailableItems = useCallback(async () => {
    // å®Ÿè£…
  }, []);

  const marketplace = useShallowMemo({
    getAvailableItems,
    searchItems,
    getItemDetail,
  });

  return (
    <NewItemMarketplaceContext.Provider value={marketplace}>
      {children}
    </NewItemMarketplaceContext.Provider>
  );
}

// providers/NewItemCatalogProvider.tsx
export default function NewItemCatalogProvider({ children }) {
  const downloadItem = useCallback(async (detail) => {
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
  }, []);

  const installItem = useCallback(async (detail) => {
    // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ­ã‚¸ãƒƒã‚¯
  }, []);

  const catalog = useShallowMemo({
    downloadItem,
    installItem,
    uninstallItem,
  });

  return (
    <NewItemCatalogContext.Provider value={catalog}>
      {children}
    </NewItemCatalogContext.Provider>
  );
}
```

3. **UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ**:

```typescript
// components/NewItemMarketplaceSettings.tsx
export default function NewItemMarketplaceSettings() {
  const marketplace = useNewItemMarketplace();
  const catalog = useNewItemCatalog();

  const { filteredItems } = useMarketplaceSearch({
    items: items,
    enableSuggestions: true,
  });

  return (
    <MarketplaceGrid items={filteredItems}>
      {(item) => (
        <MarketplaceCard
          item={item}
          onInstall={() => catalog.installItem(item)}
          onUninstall={() => catalog.uninstallItem(item.id)}
        />
      )}
    </MarketplaceGrid>
  );
}
```

### 2. å…±é€šæ©Ÿèƒ½ã®æ´»ç”¨

æ–°ã—ã„ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã§ã‚‚ã€ä»¥ä¸‹ã®å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ãƒ•ãƒƒã‚¯ã‚’æ´»ç”¨ã§ãã¾ã™:

- `useMarketplaceSearch`: çµ±ä¸€ã•ã‚ŒãŸæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- `MarketplaceCard`: ã‚¢ã‚¤ãƒ†ãƒ ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- `MarketplaceGrid`: ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- `MarketplaceHeader`: ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `MarketplaceDetailBase`: è©³ç´°ãƒšãƒ¼ã‚¸ãƒ™ãƒ¼ã‚¹
- `useMarketplaceActions`: å…±é€šæ“ä½œãƒ­ã‚¸ãƒƒã‚¯

### 3. ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆ

å„ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã§ä»¥ä¸‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½:

- **ãƒ‡ãƒ¼ã‚¿æ§‹é€ **: `MarketplaceDetail`å‹
- **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹æ³•**: fetchãƒ­ã‚¸ãƒƒã‚¯
- **æ¤œè¨¼æ–¹æ³•**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
- **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆ**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- **UIè¡¨ç¤º**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¦‹ãŸç›®

---

## ã¾ã¨ã‚

### è¨­è¨ˆã®åˆ©ç‚¹

1. **âœ… å˜ä¸€è²¬ä»»åŸå‰‡**

   - MarketplaceProvider: ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã¿
   - CatalogProvider: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ç®¡ç†ã®ã¿

2. **âœ… ä¸€è²«æ€§**

   - Extensionã¨Layoutã§åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³
   - å­¦ç¿’ã‚³ã‚¹ãƒˆã®ä½æ¸›

3. **âœ… ä¿å®ˆæ€§**

   - æ©Ÿèƒ½ã®æ‰€åœ¨ãŒæ˜ç¢º
   - ä¾å­˜é–¢ä¿‚ã®ç°¡ç´ åŒ–

4. **âœ… æ‹¡å¼µæ€§**

   - æ–°ã—ã„ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã‚’å®¹æ˜“ã«è¿½åŠ 
   - å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†åˆ©ç”¨

5. **âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
   - SHA256æ¤œè¨¼
   - ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ä»Šå¾Œã®æ”¹å–„æ¡ˆ

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

   - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ/æ‹¡å¼µæ©Ÿèƒ½ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - Lazy loading
   - ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

2. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š**

   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
   - çµ±åˆãƒ†ã‚¹ãƒˆ
   - E2Eãƒ†ã‚¹ãƒˆ

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹å‘ä¸Š**

   - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
   - ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ 
   - ãŠã™ã™ã‚ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

4. **å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®æ‹¡å……**
   - `calculateSHA256`ã‚’å…±é€šutilã¸ç§»å‹•
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®å…±é€šåŒ–
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¨™æº–åŒ–

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [å®Ÿè£…è¨ˆç”»](../../04_implementation/plans/20251015_01_refactor-layout-to-extension-pattern.md)
- [ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ä½œæ¥­ãƒ­ã‚°](../../08_worklogs/2025_10/20251015/20251015_02_refactor-layout-marketplace-to-simple-pattern.md)
- [æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ](../../08_worklogs/2025_10/20251015/20251015_03_verification-install-function-migration.md)

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2025å¹´10æœˆ15æ—¥
