# レイアウトの複数バージョン同時インストール機能 - UX評価レポート

> **評価日**: 2025年10月2日
> **評価対象**: レイアウトマーケットプレイスにおける複数バージョン同時インストール機能
> **評価方法**: ユーザー目線での利用シナリオ分析、拡張機能との比較

---

## 📋 エグゼクティブサマリー

### 評価結論

**❌ レイアウトの複数バージョン同時インストール機能は推奨しません**

レイアウトと拡張機能では根本的に使用パターンが異なり、**レイアウトでは複数バージョンの同時インストールはユーザーに混乱を招き、実用的なメリットがほとんどありません**。

### 評価スコア

| 評価項目         | スコア | 理由                         |
| ---------------- | ------ | ---------------------------- |
| **必要性**       | 🔴 1/5 | ユースケースがほぼ存在しない |
| **利便性**       | 🔴 1/5 | むしろ管理が煩雑になる       |
| **ユーザー理解** | 🔴 1/5 | 混乱を招きやすい             |
| **開発コスト**   | 🔴 2/5 | 実装は可能だが価値が低い     |
| **保守性**       | 🟡 3/5 | 追加の複雑性が発生           |

**総合評価: 🔴 1.6/5 - 実装を見送るべき**

---

## 🎯 拡張機能との比較分析

### 1. 拡張機能（Extensions）の複数バージョン管理

#### ✅ 合理的な理由

**A. API互換性の問題**

```
シナリオ: Lichtblick v1.19.x と v1.20.x で Extension API が変更

Extension v2.0.0 → v1.20.x 対応（新API使用）
Extension v1.5.0 → v1.19.x 対応（旧API使用）

必要性:
- Lichtblick をアップグレードする前に拡張機能の互換性確認
- 段階的な移行のため両バージョンを保持
- ロールバック時に旧バージョンに即座に切り替え
```

**B. 開発・デバッグ用途**

```
シナリオ: 拡張機能開発者が複数バージョンをテスト

Extension v3.0.0-beta → 新機能のテスト版
Extension v2.5.0 → 安定版（本番利用）

必要性:
- ベータ版のテストと本番版の並行利用
- 異なるバージョンでの動作比較
- 開発中の機能の影響範囲確認
```

**C. 機能セットの違い**

```
シナリオ: 同じ拡張機能で機能が大きく異なる

Extension v1.x → 基本機能のみ（軽量）
Extension v2.x → 高度な機能追加（重い）

必要性:
- 状況に応じて機能セットを使い分け
- パフォーマンス重視の場合は旧バージョン
- 新機能が必要な場合は新バージョン
```

#### 実際のユースケース例

```typescript
// 例1: Lichtblick アップグレード時
Lichtblick v1.19.12 使用中
├─ MyExtension v1.5.0 (インストール済み・有効)
└─ MyExtension v2.0.0 (インストール済み・無効) ← v1.20.x 対応版

// Lichtblick v1.20.0 にアップグレード後
Lichtblick v1.20.0 使用中
├─ MyExtension v1.5.0 (インストール済み・無効) ← 互換性なし
└─ MyExtension v2.0.0 (インストール済み・有効) ← 自動切り替え
```

### 2. レイアウト（Layouts）の複数バージョン管理

#### ❌ 非合理的な理由

**A. API依存性がない**

```
問題: レイアウトはLichtblickのバージョンにほぼ依存しない

Layout v1.0.0 → Lichtblick v1.19.x で動作
Layout v2.0.0 → Lichtblick v1.20.x でも同じように動作

理由:
- レイアウトは基本的にJSON設定ファイル
- パネル配置やグローバル変数の定義が主
- 拡張機能のようなプログラムコードではない
- APIバージョンの影響をほとんど受けない
```

**実際の互換性:**

```json
// layout-v1.0.0.json
{
  "configById": {
    "3D!1": { "type": "3D", "cameraState": {...} }
  },
  "globalVariables": { "speed": 1.0 },
  // ...基本的な設定
}

// layout-v2.0.0.json
{
  "configById": {
    "3D!1": { "type": "3D", "cameraState": {...} },
    "Plot!2": { "type": "Plot", "paths": [...] }
  },
  "globalVariables": { "speed": 1.0, "distance": 100 },
  // ...パネル追加、変数追加
}

// どちらもLichtblickのどのバージョンでも動作する
```

**B. 「使い分け」が困難**

```
問題: レイアウトを複数バージョン同時に持つメリットがない

シナリオ1: 「今日は v1.0.0 を使おう」
→ なぜ? 新バージョン v2.0.0 の方が機能が増えているはず
→ 旧バージョンに戻る理由がない

シナリオ2: 「パネル構成が違うから使い分け」
→ それは「バージョンの違い」ではなく「別のレイアウト」
→ 名前を変えて別レイアウトとして保存すべき

シナリオ3: 「バグがあるから旧バージョンに戻す」
→ レイアウトにバグは発生しにくい（JSONファイル）
→ 拡張機能のようなコード実行がないため
```

**C. ユーザー混乱の原因**

```
問題: 同じレイアウトの複数バージョンは管理が煩雑

ユーザーの疑問:
❓ "Autonomous Driving v1.0.0 と v2.0.0 の違いは何？"
❓ "どちらを使えばいいの？"
❓ "v1.0.0 をアンインストールしても v2.0.0 は残る？"
❓ "v2.0.0 を使っている時、v1.0.0 は何のために必要？"

実際の動作:
- レイアウトは「1つだけアクティブ」
- 複数バージョンがあっても1つしか使えない
- 使っていないバージョンはストレージを占有するだけ
```

---

## 💡 実際のユーザーシナリオ分析

### シナリオ1: 「前のバージョンに戻したい」

#### 拡張機能の場合 ✅ 合理的

```
状況:
- 拡張機能 v2.0.0 にアップデート
- 新バージョンでバグ発見
- 急いで前のバージョンに戻したい

アクション:
1. Extension Marketplace で v1.5.0 を選択
2. v2.0.0 を無効化
3. v1.5.0 を有効化
4. すぐに利用再開

メリット:
✅ 即座にロールバック可能
✅ ダウンタイムなし
✅ 再ダウンロード不要
```

#### レイアウトの場合 ❌ 非合理的

```
状況:
- レイアウト v2.0.0 にアップデート
- 「やっぱり前の方が良かった」

問題点:
❌ レイアウトにバグが発生することはほぼない（JSON設定）
❌ 「前の方が良かった」 = パネル配置が違う = 別のレイアウト
❌ バージョンではなく、別名で保存すべき

正しいアプローチ:
✅ "Autonomous Driving (Simple)" と "Autonomous Driving (Advanced)" を別レイアウトとして保存
✅ ユーザーが明示的に名前で区別できる
✅ バージョン管理の複雑さがない
```

### シナリオ2: 「用途に応じて使い分けたい」

#### 拡張機能の場合 ✅ 合理的

```
状況:
- データ解析用途: Extension v1.0.0 (基本機能のみ、軽量)
- デモ・プレゼン: Extension v2.0.0 (高度なビジュアル、重い)

アクション:
1. 用途に応じてバージョンを切り替え
2. パフォーマンス vs 機能のトレードオフ

メリット:
✅ 状況に応じた最適化
✅ 同じ拡張機能で異なる機能セット
```

#### レイアウトの場合 ❌ 非合理的

```
状況:
- 「シンプルなレイアウト」と「詳細なレイアウト」を使い分け

問題点:
❌ これはバージョンの問題ではない
❌ 完全に別のレイアウトとして扱うべき

正しいアプローチ:
✅ 別名で保存:
   - "Autonomous Driving - Simple View"
   - "Autonomous Driving - Detailed View"
✅ ユーザーが直感的に理解できる
✅ バージョン番号ではなく、説明的な名前
```

### シナリオ3: 「開発・テスト目的」

#### 拡張機能の場合 ✅ 合理的

```
状況:
- 拡張機能開発者
- ベータ版と安定版を並行テスト

アクション:
1. v3.0.0-beta (開発中) をインストール
2. v2.5.0 (安定版) も保持
3. 切り替えながらテスト

メリット:
✅ 開発効率の向上
✅ リグレッションテストが容易
```

#### レイアウトの場合 🟡 限定的

```
状況:
- レイアウト開発者（マーケットプレイス公開者）
- 新バージョンをテスト

問題点:
⚠️ レイアウトは即座に編集・保存可能
⚠️ わざわざ「バージョン」として管理する必要性が低い
⚠️ Lichtblick 内で直接編集できる

より良いアプローチ:
✅ "Layout Name (Testing)" として別レイアウトで保存
✅ 満足したら本番レイアウトに上書き
✅ Git などでバージョン管理（開発者側）
```

---

## 🎨 ユーザーインターフェースの複雑化

### 拡張機能の場合（複数バージョンが有用）

```
┌─ MyExtension ─────────────────────────────────────────────┐
│                                                            │
│ 📦 Version 2.0.0 (Latest) ────────────── [Details][ENABLE]│
│ ✅ Currently Active                                        │
│                                                            │
│ ▼ More Versions (2)                                       │
│ ├─ v1.5.0 (2024-08-15) ─────────────── [Details][Install]│
│ └─ v1.0.0 (2024-06-01) ─────────────── [Details][Install]│
│                                                            │
│ 💡 Tip: v1.5.0 is compatible with Lichtblick v1.19.x     │
└────────────────────────────────────────────────────────────┘

ユーザーの理解:
✅ "v2.0.0 は最新版だが、古い Lichtblick には対応していない"
✅ "v1.5.0 は古いが、互換性が高い"
✅ "目的に応じてバージョンを選べる"
```

### レイアウトの場合（複数バージョンが不要）

```
┌─ Autonomous Driving Layout ───────────────────────────────┐
│                                                            │
│ 📋 Version 2.0.0 (Latest) ────────────── [Details][Install]│
│ ✅ Currently Installed                                     │
│                                                            │
│ ▼ More Versions (2)                                       │
│ ├─ v1.5.0 (2024-08-15) ─────────────── [Details][Install]│
│ └─ v1.0.0 (2024-06-01) ─────────────── [Details][Install]│
│                                                            │
│ ❓ 何のために必要？                                         │
└────────────────────────────────────────────────────────────┘

ユーザーの混乱:
❓ "v1.5.0 と v2.0.0 の違いは？"
❓ "v1.5.0 をインストールする理由は？"
❓ "v2.0.0 を使っている時、v1.5.0 は何をする？"
❓ "両方インストールすると何が起こる？"
❓ "v1.5.0 を削除したら v2.0.0 も消える？"

より良い代替案:
✅ 「別のレイアウトとして保存」を促す
✅ バージョン管理ではなく、レイアウトのコピー機能
```

---

## 📊 機能実装の価値分析

### 開発コスト vs ユーザーメリット

| 項目             | 拡張機能      | レイアウト  |
| ---------------- | ------------- | ----------- |
| **実装コスト**   | 🔴 高         | 🔴 高       |
| **UI複雑度**     | 🟡 中         | 🟡 中       |
| **ユーザー理解** | 🟢 比較的容易 | 🔴 困難     |
| **実用性**       | 🟢 高い       | 🔴 ほぼない |
| **保守コスト**   | 🟡 中         | 🟡 中       |
| **価値**         | ✅ 高い       | ❌ 低い     |

### 機能の ROI（投資対効果）

```
拡張機能の複数バージョン管理:
開発コスト: 40-60時間
ユーザーメリット: 高（互換性管理、段階的移行、ロールバック）
ROI: ✅ 高い

レイアウトの複数バージョン管理:
開発コスト: 40-60時間
ユーザーメリット: 低（ほとんどユースケースがない）
ROI: ❌ 非常に低い
```

---

## 🔍 ユーザー調査の想定結果

### 拡張機能利用者へのヒアリング（想定）

**質問: 「同じ拡張機能の複数バージョンを同時にインストールしたいですか？」**

```
回答1: "はい。Lichtblick をアップデートする前に、
        新バージョンの拡張機能が動作するか確認したい"
→ 合理的なニーズ

回答2: "はい。開発中の拡張機能をテストしながら、
        本番環境では安定版を使いたい"
→ 合理的なニーズ

回答3: "はい。軽量版と高機能版を状況に応じて切り替えたい"
→ 合理的なニーズ
```

### レイアウト利用者へのヒアリング（想定）

**質問: 「同じレイアウトの複数バージョンを同時にインストールしたいですか？」**

```
回答1: "いいえ。最新版だけあれば十分"
→ ほとんどのユーザー

回答2: "わからない。何のために必要なの？"
→ 機能の意図が理解されない

回答3: "シンプル版と詳細版を使い分けたいけど、
        それは別のレイアウトとして保存する方が分かりやすい"
→ バージョン管理ではなく、別レイアウトが適切

回答4: "前のバージョンに戻したいことがあるかも"
→ 実際にはレイアウトのロールバックが必要になるケースは稀
→ バージョン管理ではなく、履歴機能（Undo/Redo）の方が有用
```

---

## 💡 推奨される代替アプローチ

### 1. レイアウトの「バリエーション」管理

**コンセプト:** バージョンではなく、バリエーションとして扱う

```typescript
// 現在の設計（バージョン管理）❌
"Autonomous Driving v1.0.0"
"Autonomous Driving v2.0.0"
↓ ユーザーの混乱

// 推奨設計（バリエーション管理）✅
"Autonomous Driving - Simple"
"Autonomous Driving - Advanced"
"Autonomous Driving - Debug"
↓ 目的が明確
```

**実装例:**

```typescript
interface LayoutMarketplaceDetail {
  id: string;
  name: string;
  version: string; // 最新バージョンのみ表示
  description: string;

  // バリエーション機能（推奨）
  variants?: {
    name: string; // "Simple", "Advanced", "Debug"
    description: string;
    layoutUrl: string;
  }[];
}
```

**メリット:**

- ✅ ユーザーが目的で選べる
- ✅ バージョン番号の混乱がない
- ✅ 明確な命名で直感的
- ✅ 複数インストールの必要性が自然

### 2. レイアウトの「スナップショット」機能

**コンセプト:** ユーザーが自分で過去の状態を保存

```typescript
// レイアウトの履歴機能
interface LayoutSnapshot {
  id: string;
  layoutId: string;
  name: string; // "Before Camera Change", "2024-09-15 Backup"
  timestamp: string;
  data: LayoutData;
  autoSaved: boolean; // 自動保存 or 手動保存
}

// 使用例
const layoutManager = useLayoutManager();

// 自動スナップショット（重要な変更前）
await layoutManager.createSnapshot({
  layoutId: "my-layout",
  name: "Auto: Before panel rearrangement",
  autoSaved: true,
});

// 手動スナップショット
await layoutManager.createSnapshot({
  layoutId: "my-layout",
  name: "Backup before experiment",
  autoSaved: false,
});
```

**メリット:**

- ✅ ユーザーが必要な時だけ履歴を保存
- ✅ 説明的な名前を付けられる
- ✅ Git のコミット履歴のような使い勝手
- ✅ マーケットプレイスのバージョン管理とは独立

### 3. レイアウトの「テンプレート」システム

**コンセプト:** マーケットプレイスはテンプレートとして提供

```typescript
// テンプレートベースのアプローチ
interface LayoutTemplate {
  id: string;
  name: string;
  description: string;
  category: "autonomous" | "data-analysis" | "debug";

  // ベーステンプレート
  baseTemplate: LayoutData;

  // カスタマイズオプション
  customizationOptions: {
    panelDensity: "minimal" | "normal" | "detailed";
    theme: "light" | "dark";
    advancedFeatures: boolean;
  };
}

// インストール時にカスタマイズ
const result = await installLayoutTemplate(template, {
  panelDensity: "detailed",
  theme: "dark",
  advancedFeatures: true,
});
```

**メリット:**

- ✅ ユーザーが好みに応じてカスタマイズ
- ✅ 「バージョン」ではなく「カスタマイズ」
- ✅ インストール時に1回設定するだけ
- ✅ 複数バージョン管理の必要性なし

---

## 🎯 推奨実装方針

### Phase 1: 拡張機能のみ複数バージョン対応（現在の計画）✅

```
対象: Extensions
理由:
- API互換性の問題が実際に存在
- 開発・テスト用途で有用
- ユーザーが理解しやすい

実装:
✅ 複数バージョン同時インストール
✅ バージョン切り替え機能
✅ VERSIONタブでの管理
```

### Phase 2: レイアウトはシンプルに保つ（推奨）✅

```
対象: Layouts
方針:
✅ 最新バージョンのみ表示
✅ 更新時は自動的に上書き
✅ 「複数バージョン」ではなく「複数レイアウト」として管理

代替機能:
✅ レイアウトのコピー機能
✅ スナップショット機能（履歴管理）
✅ バリエーション機能（オプション）
```

### Phase 3: 高度な機能は必要に応じて追加（将来）

```
ユーザーフィードバックに基づき、以下を検討:

1. レイアウトスナップショット機能
   - 重要な変更前に自動保存
   - 手動でバックアップ作成
   - 過去の状態に簡単に戻せる

2. レイアウトバリエーション
   - 同じベースレイアウトの異なる構成
   - "Simple", "Advanced", "Debug" など
   - 目的別に明確に分類

3. レイアウトテンプレート
   - カスタマイズ可能なベーステンプレート
   - インストール時に設定を選択
```

---

## 📈 実装優先度マトリクス

```
                高い実用性
                    ↑
    拡張機能の複数バージョン管理 ✅ 実装すべき
                    │
                    │
    レイアウトのスナップショット 🟡 検討価値あり
                    │
低い実装コスト ─────┼───── 高い実装コスト
                    │
    レイアウトのバリエーション 🟡 将来的に検討
                    │
                    │
    レイアウトの複数バージョン管理 ❌ 実装不要
                    ↓
                低い実用性
```

---

## 🎓 ベストプラクティス（類似プロダクト分析）

### VS Code（Extensions）

```
複雑バージョン管理: ✅ あり
理由:
- 拡張機能はプログラムコード
- API互換性の問題が頻繁
- 開発・テスト用途が一般的

実装:
- インストール済みバージョンと最新バージョンを並行管理
- ワークスペースごとに異なるバージョンを使用可能
```

### Figma（Design Files）

```
複数バージョン管理: ❌ なし
理由:
- デザインファイルは設定データ
- バージョン管理ではなく「履歴」機能
- 過去の任意の時点に戻せる

実装:
- ファイルの編集履歴を自動保存
- 任意の時点に復元可能
- 「Version 2.0」ではなく「September 15 backup」のような管理
```

**→ レイアウトは Figma の設計に近い**

### Sketch（Plugins）

```
複数バージョン管理: 🟡 限定的
理由:
- プラグインは実行コード（拡張機能的）
- テンプレートはデータ（レイアウト的）

実装:
- Plugins: バージョン管理あり
- Templates: バージョン管理なし、コピーで管理
```

**→ 拡張機能とレイアウトで扱いを分けるべき**

---

## 💡 結論と推奨事項

### 最終推奨

**1. 拡張機能（Extensions）**

```
✅ 複数バージョン同時インストール機能を実装
理由:
- 実際のユースケースが多数存在
- ユーザーが理解しやすい
- 開発・運用上のメリットが明確
```

**2. レイアウト（Layouts）**

```
❌ 複数バージョン同時インストール機能は実装しない
代わりに:
✅ 最新バージョンのみインストール
✅ 更新時は自動上書き
✅ レイアウトの「コピー」機能で代替
✅ 将来的にスナップショット機能を検討
```

### 実装スコープの調整

#### 現在の計画（要修正）

```
❌ Extension と Layout で同じ複数バージョン管理を実装
```

#### 推奨する調整

```
✅ Extension: 複数バージョン管理を完全実装
✅ Layout: シンプルな単一バージョン管理

実装の分離:
- 共通UIコンポーネント（MarketplaceCard等）は両方で使用
- バージョン管理ロジックは Extension のみ
- Layout は最新版のみのシンプルな実装
```

### 開発工数の最適化

```
現在の計画:
Extension + Layout 複数バージョン管理 = 80-120時間

推奨する調整:
Extension 複数バージョン管理 = 60-80時間
Layout シンプル実装 = 20-30時間
─────────────────────────────────────
合計 = 80-110時間

削減工数: 10-20時間
品質向上: ユーザー体験の改善
```

---

## 📞 ユーザーへのコミュニケーション

### UI での説明文（推奨）

**拡張機能:**

```
💡 Multiple Versions Available
Extensions may have different versions for compatibility with
various Lichtblick versions. You can install multiple versions
and switch between them as needed.
```

**レイアウト:**

```
💡 Latest Version Recommended
Layouts are automatically updated to the latest version.
If you want different variations, save them as separate layouts
with descriptive names.
```

### ドキュメントでの説明

```markdown
## Version Management

### Extensions

Extensions support multiple version installations. This allows you to:

- Test new versions while keeping stable versions
- Maintain compatibility across Lichtblick updates
- Switch between versions for different use cases

### Layouts

Layouts are always updated to the latest version. If you need
different configurations:

- Create separate layouts with descriptive names
- Use the "Save As" feature to create variations
- Consider using layout snapshots (coming soon)
```

---

## 🚀 ロードマップ

### 短期（現在のリリース）

```
✅ 拡張機能の複数バージョン管理実装
✅ レイアウトのシンプルな単一バージョン管理
✅ レイアウトのコピー機能改善
```

### 中期（次回リリース）

```
🔄 レイアウトスナップショット機能
🔄 レイアウトバリエーション機能の検討
🔄 ユーザーフィードバックの収集
```

### 長期（将来のリリース）

```
💡 ユーザーフィードバックに基づく機能改善
💡 テンプレートシステムの検討
💡 より高度なレイアウト管理機能
```

---

**Document Version**: 1.0.0
**Last Updated**: 2025年10月2日
**Author**: AI UX Evaluator
**Status**: Complete
