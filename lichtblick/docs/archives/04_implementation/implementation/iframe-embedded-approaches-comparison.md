# 実装アプローチ比較表

## 📊 3つのアプローチの比較

iframe埋め込み時にファイル名のみを表示する機能について、3つの実装アプローチを比較します。

---

## 🎯 アプローチ概要

### アプローチA: 完全分離型（標準アプローチ）

**ファイル**: [iframe-embedded-filename-display.md](./iframe-embedded-filename-display.md)

iframe検出と表示名生成を**完全に別々のファイル**に分離した、保守性・拡張性重視のアプローチ

### アプローチB: iframe判定分離型（推奨アプローチ）⭐

**ファイル**: [iframe-embedded-filename-display-separated-approach.md](./iframe-embedded-filename-display-separated-approach.md)

iframe検出のみ独立ファイルに分離し、再利用性と実装効率のバランスを取ったアプローチ

### アプローチC: 完全統合型（最小変更アプローチ）

**ファイル**: [iframe-embedded-filename-display-minimal-approach.md](./iframe-embedded-filename-display-minimal-approach.md)

iframe検出と表示名生成を**1つのファイル**に統合した、シンプル重視のアプローチ

---

## 📈 定量的比較

| 指標               | A（完全分離） | B（判定分離）⭐ | C（完全統合） |
| ------------------ | ------------- | --------------- | ------------- |
| **新規ファイル数** | 4個           | 2個             | 1個           |
| **総コード行数**   | 約410行       | 約80行          | 約50行        |
| **テスト行数**     | 約230行       | 約100行         | 約60行        |
| **修正ファイル数** | 1個           | 1個             | 1個           |
| **修正行数**       | 2行           | 3行             | 3行           |
| **実装時間**       | 約2時間       | **約1時間**     | 約35分        |
| **レビュー時間**   | 約40分        | **約20分**      | 約10分        |
| **再利用性**       | ⭐⭐⭐⭐⭐    | ⭐⭐⭐⭐        | ⭐⭐          |
| **保守性**         | ⭐⭐⭐⭐⭐    | ⭐⭐⭐⭐        | ⭐⭐⭐        |

---

## 🔍 定性的比較

### ファイル構成

#### アプローチA: 完全分離型

```
packages/suite-base/src/util/
├── isEmbedded.ts              (60行) - iframe検出専用
├── isEmbedded.test.ts         (80行)
├── getDisplayName.ts          (120行) - 表示名生成専用
└── getDisplayName.test.ts     (150行)

packages/suite-base/src/dataSources/
└── RemoteDataSourceFactory.tsx (2行変更)
```

#### アプローチB: iframe判定分離型 ⭐推奨

```
packages/suite-base/src/util/
├── isEmbedded.ts              (30行) - iframe検出専用（再利用可）
├── isEmbedded.test.ts         (40行)
├── displayNameForUrl.ts       (50行) - 表示名生成
└── displayNameForUrl.test.ts  (60行)

packages/suite-base/src/dataSources/
└── RemoteDataSourceFactory.tsx (3行変更)
```

#### アプローチC: 完全統合型

```
packages/suite-base/src/util/
├── displayNameForUrl.ts       (50行) - 全機能統合
└── displayNameForUrl.test.ts  (60行)

packages/suite-base/src/dataSources/
└── RemoteDataSourceFactory.tsx (3行変更)
```

---

### コードの複雑さ

| 項目                 | アプローチA                         | アプローチB     |
| -------------------- | ----------------------------------- | --------------- |
| **モジュール間依存** | あり（getDisplayName → isEmbedded） | なし            |
| **import文の数**     | 2個                                 | 1個             |
| **関数の責任範囲**   | 明確（単一責任の原則）              | 広い（複合的）  |
| **理解のしやすさ**   | 各ファイルは単純                    | 1ファイルで完結 |

---

## ⚖️ メリット・デメリット比較

### アプローチA: 分離型

#### ✅ メリット

1. **単一責任の原則**: 各モジュールが1つの責任のみを持つ
2. **再利用性**: `isEmbedded()`を他の場所でも使用可能
3. **テスト性**: 各機能を独立してテスト可能
4. **拡張性**: 新機能追加が容易
5. **保守性**: コード変更時の影響範囲が明確

#### ❌ デメリット

1. **ファイル数増加**: 4つの新規ファイルが必要
2. **コード量増加**: 合計410行のコード
3. **実装時間**: 約2時間必要
4. **レビュー負荷**: 複数ファイルのレビューが必要
5. **複雑性**: モジュール間の依存関係を理解する必要

---

### アプローチB: 統合型

#### ✅ メリット

1. **シンプル**: 1ファイルで完結、理解しやすい
2. **コード量最小**: 合計50行のみ
3. **実装時間短縮**: 約35分で完了
4. **レビュー容易**: レビュー対象が少ない
5. **低リスク**: 既存コードへの影響が最小限
6. **デバッグ容易**: 問題の切り分けが簡単

#### ❌ デメリット

1. **責任の混在**: iframe検出と表示名生成が同一ファイル
2. **再利用性低**: iframe検出機能の単独再利用は困難
3. **拡張時の変更**: 機能追加時にファイルが肥大化する可能性

---

## 🎯 選択基準

### アプローチA（分離型）を選ぶべき場合

✅ **以下の条件に当てはまる場合に推奨**

1. **iframe検出を他の場所でも使う予定がある**

   - 例: 他のデータソースでも使用
   - 例: UI表示の切り替えに使用

2. **長期的な保守性を重視**

   - プロジェクトが長期間継続
   - 複数の開発者が関わる

3. **機能拡張の可能性が高い**

   - 表示モードの追加予定あり
   - URLパラメータでの制御を追加予定

4. **厳格なコード品質基準がある**
   - 単一責任の原則を厳守
   - 各モジュールが独立してテスト可能であることが必須

---

### アプローチB（統合型）を選ぶべき場合

✅ **以下の条件に当てはまる場合に推奨**

1. **既存コードへの変更を最小限に抑えたい**

   - リスクを最小化したい
   - 既存機能への影響を懸念

2. **迅速な実装が必要**

   - 短期間でリリースしたい
   - MVP（Minimum Viable Product）として実装

3. **この機能が独立している**

   - iframe検出は他で使わない
   - RemoteDataSourceFactoryでのみ使用

4. **チームが小規模またはレビューリソースが限られている**
   - 短時間でレビュー完了させたい
   - 複雑な依存関係を避けたい

---

## 💡 推奨アプローチ

### 🏆 **アプローチB（iframe判定分離型）を推奨** ⭐

#### 理由

1. **iframe検出の再利用性を確保**

   - `isEmbedded()`を独立したモジュールとして提供
   - 将来的に他のコンポーネントでも使用可能
   - ユーザーの要求（iframe判定を別ファイルに）を満たす

2. **バランスの取れた実装コスト**

   - 完全統合型より若干複雑だが、実装時間は約1時間
   - 完全分離型の半分のコード量（410行→80行）
   - レビュー時間も許容範囲（約20分）

3. **保守性と拡張性**

   - 各モジュールの責任範囲が明確
   - iframe検出ロジックの変更が容易
   - 表示名生成ロジックの拡張も可能

4. **既存コードへの影響は最小限**

   - 修正は3行のみ
   - リスクが低い

5. **段階的な改善が可能**
   - 必要に応じて表示名生成も分離可能
   - 将来的にアプローチAへの移行も容易

---

## 🔄 移行パス

### アプローチC → アプローチB への移行

完全統合型から判定分離型へ（iframe検出の再利用が必要な場合）：

```
Step 1: isEmbedded.ts を分離
  └─ displayNameForUrl.ts から iframe検出部分を抽出

Step 2: import文の追加
  └─ displayNameForUrl.ts に import { isEmbedded } 追加

Step 3: テストファイルの分離
  └─ isEmbedded.test.ts を作成
```

**移行コスト**: 約30分

### アプローチB → アプローチA への移行

判定分離型から完全分離型へ（さらなる分離が必要な場合）：

```
Step 1: getDisplayName.ts にリネーム・拡張
  └─ displayNameForUrl.ts をリネーム・リファクタリング
  └─ extractFilename()などのヘルパー関数を追加

Step 2: テストの拡張
  └─ より包括的なテストケースを追加

Step 3: 必要に応じてドキュメント更新
```

**移行コスト**: 約1時間

---

## 📋 決定マトリックス

| 評価項目                   | 重要度     | A（完全分離） | B（判定分離）⭐ | C（完全統合）      |
| -------------------------- | ---------- | ------------- | --------------- | ------------------ |
| **実装時間**               | ⭐⭐⭐⭐⭐ | ❌ 2時間      | ✅ 1時間        | ✅ 35分            |
| **既存コードへの影響**     | ⭐⭐⭐⭐⭐ | ✅ 最小限     | ✅ 最小限       | ✅ 最小限          |
| **コードの理解しやすさ**   | ⭐⭐⭐⭐   | ✅ 明確       | ✅ 明確         | ✅ 1ファイルで完結 |
| **再利用性（iframe検出）** | ⭐⭐⭐⭐   | ✅ 高い       | ✅ 高い         | ❌ 低い            |
| **保守性**                 | ⭐⭐⭐⭐   | ✅ 優秀       | ✅ 良好         | ⚠️ 許容範囲        |
| **テストカバレッジ**       | ⭐⭐⭐⭐   | ✅ 包括的     | ✅ 十分         | ✅ 十分            |
| **レビュー負荷**           | ⭐⭐⭐⭐   | ❌ 40分       | ✅ 20分         | ✅ 10分            |
| **拡張性**                 | ⭐⭐⭐     | ✅ 容易       | ✅ 可能         | ⚠️ 後で対応        |

**スコア（40点満点）**:

- アプローチA（完全分離）: 32点
- **アプローチB（判定分離）: 37点** ✨✨✨
- アプローチC（完全統合）: 33点

---

## 🚀 実装ステップ（推奨）

### アプローチB（統合型）の実装手順

```bash
# 1. ファイル作成（5分）
touch packages/suite-base/src/util/displayNameForUrl.ts
touch packages/suite-base/src/util/displayNameForUrl.test.ts

# 2. コード実装（15分）
# displayNameForUrl.ts と displayNameForUrl.test.ts を実装

# 3. RemoteDataSourceFactory修正（5分）
# import追加 + name行変更

# 4. テスト実行（5分）
yarn test displayNameForUrl.test.ts

# 5. 動作確認（10分）
yarn web:serve
# ブラウザとiframeで確認

# 6. コミット（5分）
git add .
git commit -m "feat: Display filename only in iframe embedded mode"

# 合計: 約45分（バッファ含む）
```

---

## ✅ まとめ

### 最終推奨

**アプローチB（iframe判定分離型）を採用する** ⭐⭐⭐⭐⭐

### 理由サマリー

1. 🎯 **ユーザー要求を満たす**: iframe判定を別ファイルに分離
2. ♻️ **再利用性を確保**: `isEmbedded()`を他でも使用可能
3. ⚡ **実装時間が適切**: 約1時間（完全分離の半分）
4. 📉 **コード量が適切**: 約80行（完全分離の約1/5）
5. ⏱️ **レビュー負荷が軽い**: 約20分（完全分離の半分）
6. 🔧 **保守性が高い**: 各モジュールの責任範囲が明確
7. ✅ **機能要件を完全に満たす**
8. 🔄 **将来の拡張も容易**

### 各アプローチの適用シーン

| アプローチ          | 適用シーン                                   |
| ------------------- | -------------------------------------------- |
| **A（完全分離）**   | 大規模プロジェクト、長期保守、多数の開発者   |
| **B（判定分離）⭐** | **一般的な開発、バランス重視、再利用性必要** |
| **C（完全統合）**   | プロトタイプ、短期プロジェクト、単独使用     |

### 実装方針

```
第1段階: アプローチBで実装（推奨）
    ├─ iframe検出を独立モジュール化
    ├─ 表示名生成を実装
    └─ 約1時間で完了
         ↓
第2段階: 必要に応じて拡張
    ├─ 他のコンポーネントでisEmbedded()を活用
    ├─ 表示名生成機能を拡張
    └─ 必要なら完全分離型へ移行
```

このバランス型アプローチにより、**現在と将来の両方のニーズに対応**できます。

---

**作成日**: 2025年10月6日
**最終更新**: 2025年10月6日
**推奨アプローチ**: **アプローチB（iframe判定分離型）** ⭐⭐⭐⭐⭐
