# Lichtblick æ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Lichtblickæ‹¡å¼µæ©Ÿèƒ½ã‚·ã‚¹ãƒ†ãƒ ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¨é–‹ç™ºæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“– ç›®æ¬¡

- [åŸºæœ¬æ¦‚å¿µ](#åŸºæœ¬æ¦‚å¿µ)
- [æ‹¡å¼µæ©Ÿèƒ½ã®ç¨®é¡](#æ‹¡å¼µæ©Ÿèƒ½ã®ç¨®é¡)
- [é–‹ç™ºç’°å¢ƒã®æº–å‚™](#é–‹ç™ºç’°å¢ƒã®æº–å‚™)
- [å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³](#å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³)
- [åˆ¶é™äº‹é …](#åˆ¶é™äº‹é …)
- [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

## ğŸ¯ åŸºæœ¬æ¦‚å¿µ

### æ‹¡å¼µæ©Ÿèƒ½ã¨ã¯

Lichtblickæ‹¡å¼µæ©Ÿèƒ½ã¯ã€Lichtblickã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ©Ÿèƒ½ã‚’æ‹¡å¼µã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚TypeScriptã¨Reactã‚’ä½¿ç”¨ã—ã¦é–‹ç™ºã—ã€ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸç’°å¢ƒã§å®‰å…¨ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‹¡å¼µæ©Ÿèƒ½ (.foxe ãƒ•ã‚¡ã‚¤ãƒ«)               â”‚
â”‚ â”œâ”€ package.json (ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿)           â”‚
â”‚ â”œâ”€ dist/ (ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ã‚³ãƒ¼ãƒ‰)         â”‚
â”‚ â””â”€ assets/ (ãƒªã‚½ãƒ¼ã‚¹)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ @lichtblick/suite SDK                   â”‚
â”‚ â”œâ”€ ExtensionContext                     â”‚
â”‚ â”œâ”€ PanelExtensionContext                â”‚
â”‚ â””â”€ å‹å®šç¾©                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Lichtblick Core                         â”‚
â”‚ â”œâ”€ ExtensionCatalog                     â”‚
â”‚ â”œâ”€ PanelExtensionAdapter                â”‚
â”‚ â””â”€ MessagePipeline                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: TypeScript
- **UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: React
- **SDK**: @lichtblick/suite
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«**: create-lichtblick-extension
- **é…å¸ƒå½¢å¼**: .foxe ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆZIPã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰

## ğŸ”§ æ‹¡å¼µæ©Ÿèƒ½ã®ç¨®é¡

### 1. ãƒ‘ãƒãƒ«æ‹¡å¼µæ©Ÿèƒ½

ã‚«ã‚¹ã‚¿ãƒ UIãƒ‘ãƒãƒ«ã‚’è¿½åŠ ã™ã‚‹æœ€ã‚‚ä¸€èˆ¬çš„ãªæ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

**ç‰¹å¾´:**

- Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®UI
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºãƒ»æ“ä½œ
- ãƒ‘ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¸ã®çµ±åˆ

**ç”¨é€”ä¾‹:**

- ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ãƒ‘ãƒãƒ«
- åˆ¶å¾¡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ã‚«ã‚¹ã‚¿ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### 2. MessageConverter

ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’å¤‰æ›ã—ã¦ã€æ—¢å­˜ãƒ‘ãƒãƒ«ã§è¡¨ç¤ºå¯èƒ½ã«ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

**ç‰¹å¾´:**

- å…¥åŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼ã‹ã‚‰å‡ºåŠ›å½¢å¼ã¸ã®å¤‰æ›
- MessagePipelineã¸ã®è‡ªå‹•çµ±åˆ
- æ—¢å­˜ãƒ‘ãƒãƒ«ã®æ©Ÿèƒ½æ‹¡å¼µï¼ˆé–“æ¥çš„ï¼‰

**ç”¨é€”ä¾‹:**

- ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ¨™æº–å½¢å¼å¤‰æ›
- ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•ç”Ÿæˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµ±ä¸€

### 3. ãã®ä»–ã®æ‹¡å¼µ

- **TopicAliases**: ãƒˆãƒ”ãƒƒã‚¯åã®ãƒãƒƒãƒ”ãƒ³ã‚°
- **CameraModel**: ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ‡ãƒ«ã®ç™»éŒ²
- **CustomMessageSchemas**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©

## ğŸ› ï¸ é–‹ç™ºç’°å¢ƒã®æº–å‚™

### 1. å‰ææ¡ä»¶

- Node.js 16ä»¥ä¸Š
- npm ã¾ãŸã¯ yarn
- VS Codeï¼ˆæ¨å¥¨ï¼‰

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```bash
# æ–°ã—ã„æ‹¡å¼µæ©Ÿèƒ½ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
npm init lichtblick-extension@latest my-extension

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd my-extension

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install
```

### 3. é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«

```bash
# é–‹ç™ºãƒ»ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
npm run local-install

# Lichtblickã‚’å†èµ·å‹•ã¾ãŸã¯ Ctrl+R ã§ãƒªãƒ­ãƒ¼ãƒ‰

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ï¼ˆé…å¸ƒç”¨ï¼‰
npm run package
```

## ğŸ“ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. åŸºæœ¬çš„ãªãƒ‘ãƒãƒ«æ‹¡å¼µ

```typescript
// src/index.ts - ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
import { ExtensionContext } from "@lichtblick/suite";
import { initMyPanel } from "./MyPanel";

export function activate(extensionContext: ExtensionContext): void {
  extensionContext.registerPanel({
    name: "My Custom Panel",
    initPanel: initMyPanel,
  });
}
```

```typescript
// src/MyPanel.tsx - ãƒ‘ãƒãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
import { PanelExtensionContext, Topic, MessageEvent } from "@lichtblick/suite";
import { useLayoutEffect, useState } from "react";
import { createRoot } from "react-dom/client";

function MyPanel({ context }: { context: PanelExtensionContext }) {
  const [topics, setTopics] = useState<Topic[]>();
  const [messages, setMessages] = useState<MessageEvent[]>();

  useLayoutEffect(() => {
    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®è¨­å®š
    context.onRender = (renderState, done) => {
      setTopics(renderState.topics);
      setMessages(renderState.currentFrame);
      done(); // å¿…é ˆ: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã®é€šçŸ¥
    };

    // ç›£è¦–å¯¾è±¡ã®è¨­å®š
    context.watch("topics");
    context.watch("currentFrame");

    // ãƒˆãƒ”ãƒƒã‚¯è³¼èª­
    context.subscribe([{ topic: "/robot/status" }]);
  }, []);

  return (
    <div style={{ padding: "1rem" }}>
      <h2>My Custom Panel</h2>
      <p>Topics: {topics?.length || 0}</p>
      <p>Messages: {messages?.length || 0}</p>
      {messages?.map((msg, idx) => (
        <div key={idx}>
          {msg.topic}: {JSON.stringify(msg.message)}
        </div>
      ))}
    </div>
  );
}

export function initMyPanel(context: PanelExtensionContext): () => void {
  const root = createRoot(context.panelElement);
  root.render(<MyPanel context={context} />);

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’è¿”ã™
  return () => root.unmount();
}
```

### 2. MessageConverterå®Ÿè£…

```typescript
// src/index.ts
import { ExtensionContext } from "@lichtblick/suite";

export function activate(extensionContext: ExtensionContext): void {
  extensionContext.registerMessageConverter({
    fromSchemaName: "custom_msgs/RobotData",
    toSchemaName: "geometry_msgs/Twist",
    converter: convertRobotData,
  });
}

async function convertRobotData(input: any): Promise<any> {
  // ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æ¨™æº–å½¢å¼ã«å¤‰æ›
  return {
    linear: { x: input.velocity, y: 0, z: 0 },
    angular: { x: 0, y: 0, z: input.angular_velocity },
  };
}
```

### 3. è¨­å®šå¯èƒ½ãªãƒ‘ãƒãƒ«

```typescript
// ãƒ‘ãƒãƒ«è¨­å®šã®å®Ÿè£…
export function initConfigurablePanel(context: PanelExtensionContext): () => void {
  let config = context.initialState || { refreshRate: 10, showGrid: true };

  const ConfigurablePanel = () => {
    const [currentConfig, setCurrentConfig] = useState(config);

    useLayoutEffect(() => {
      context.onRender = (renderState, done) => {
        // è¨­å®šãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆ
        if (renderState.config) {
          setCurrentConfig(renderState.config);
          config = renderState.config;
        }
        done();
      };

      context.watch("config");
    }, []);

    return (
      <div>
        <h2>Configurable Panel</h2>
        <p>Refresh Rate: {currentConfig.refreshRate}Hz</p>
        <p>Show Grid: {currentConfig.showGrid ? "Yes" : "No"}</p>
      </div>
    );
  };

  const root = createRoot(context.panelElement);
  root.render(<ConfigurablePanel />);
  return () => root.unmount();
}
```

## âš ï¸ åˆ¶é™äº‹é …

### æŠ€è¡“çš„åˆ¶é™

#### 1. æ—¢å­˜ãƒ‘ãƒãƒ«ã®å¤‰æ›´ä¸å¯

```typescript
// âŒ æ—¢å­˜ãƒ‘ãƒãƒ«ã‚’ç›´æ¥å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“
extensionContext.registerPanel({
  name: "Plot", // æ—¢å­˜ãƒ‘ãƒãƒ«åã¨åŒã˜ - é‡è¤‡ã‚¨ãƒ©ãƒ¼
  initPanel: myCustomPlot,
});
```

**ç†ç”±**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®‰å®šæ€§ã®ãŸã‚

**ä»£æ›¿æ¡ˆ**: æ–°ã—ã„åå‰ã§ãƒ‘ãƒãƒ«ã‚’ä½œæˆ

```typescript
// âœ… æ–°ã—ã„åå‰ã§æ©Ÿèƒ½æ‹¡å¼µç‰ˆã‚’ä½œæˆ
extensionContext.registerPanel({
  name: "Enhanced Plot", // æ–°ã—ã„åå‰
  initPanel: myEnhancedPlot,
});
```

#### 2. ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åˆ¶é™

- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ **: ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: åˆ¶é™ä»˜ãã‚¢ã‚¯ã‚»ã‚¹
- **DOM**: å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸè¦ç´ å†…ã®ã¿æ“ä½œå¯èƒ½
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°**: ä»–ã®æ‹¡å¼µæ©Ÿèƒ½ã¨ã¯åˆ†é›¢

#### 3. APIåˆ¶é™

- **ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ **: å†…éƒ¨APIã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- **ä»–ã®æ‹¡å¼µæ©Ÿèƒ½**: ç›´æ¥é€šä¿¡åˆ¶é™
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ã®åˆ¶é™

### è¨­è¨ˆçš„åˆ¶é™

#### 1. UI/UXä¸€è²«æ€§

æ‹¡å¼µæ©Ÿèƒ½ã¯æ—¢å­˜ã®Lichtblick UI/UXã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«å¾“ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### 2. å¾Œæ–¹äº’æ›æ€§

Lichtblickã®æ›´æ–°ã«ã‚ˆã£ã¦æ‹¡å¼µæ©Ÿèƒ½ãŒå‹•ä½œã—ãªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## ğŸŒŸ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. å‘½åè¦å‰‡

```typescript
// âœ… è‰¯ã„ä¾‹ï¼šæ©Ÿèƒ½ãŒæ˜ç¢º
extensionContext.registerPanel({
  name: "Robot Status Monitor",
  // ã¾ãŸã¯
  name: "Plot Enhanced",
  name: "3D Viewer Pro",
});

// âŒ æ‚ªã„ä¾‹ï¼šæ—¢å­˜åã¨é‡è¤‡
extensionContext.registerPanel({
  name: "Plot",
  name: "3D",
});
```

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
export function activate(extensionContext: ExtensionContext): void {
  try {
    extensionContext.registerPanel({
      name: "My Panel",
      initPanel: initMyPanel,
    });
    console.log("Extension activated successfully");
  } catch (error) {
    console.error("Failed to activate extension:", error);
    // å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
  }
}
```

### 3. ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†

```typescript
export function initMyPanel(context: PanelExtensionContext): () => void {
  const cleanup = [];

  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
  const handleClick = () => { /* ... */ };
  context.panelElement.addEventListener("click", handleClick);
  cleanup.push(() => context.panelElement.removeEventListener("click", handleClick));

  // ã‚¿ã‚¤ãƒãƒ¼ã®è¨­å®š
  const interval = setInterval(() => { /* ... */ }, 1000);
  cleanup.push(() => clearInterval(interval));

  const root = createRoot(context.panelElement);
  root.render(<MyPanel context={context} />);

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°
  return () => {
    cleanup.forEach(fn => fn());
    root.unmount();
  };
}
```

### 4. TypeScriptæ´»ç”¨

```typescript
// å‹å®‰å…¨ãªå®Ÿè£…
interface MyPanelConfig {
  refreshRate: number;
  showDetails: boolean;
  colorScheme: "light" | "dark";
}

interface MyMessageType {
  timestamp: number;
  data: {
    temperature: number;
    humidity: number;
  };
}

function MyTypedPanel({ context }: { context: PanelExtensionContext }) {
  const [config, setConfig] = useState<MyPanelConfig>();
  const [messages, setMessages] = useState<MessageEvent<MyMessageType>[]>();

  // ... å®Ÿè£…
}
```

### 5. ãƒ†ã‚¹ãƒˆ

```typescript
// Jest ãƒ†ã‚¹ãƒˆä¾‹
describe("MyPanel", () => {
  it("should render correctly", () => {
    const mockContext = {
      panelElement: document.createElement("div"),
      onRender: jest.fn(),
      watch: jest.fn(),
      subscribe: jest.fn(),
    };

    const cleanup = initMyPanel(mockContext as any);

    expect(mockContext.watch).toHaveBeenCalledWith("topics");
    expect(mockContext.subscribe).toHaveBeenCalled();

    cleanup();
  });
});
```

## ğŸ”— é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

- [MessageConverterè©³ç´°ã‚¬ã‚¤ãƒ‰](./messageconverter-guide.md)
- [ãƒ‘ãƒãƒ«æ‹¡å¼µæ€§ã«ã¤ã„ã¦](./panel-extensibility.md)
- [æ‹¡å¼µæ©Ÿèƒ½ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](../templates/extension-template.md)
- [create-lichtblick-extension](https://www.npmjs.com/package/create-lichtblick-extension)
- [@lichtblick/suite API Reference](https://github.com/Lichtblick-Suite/lichtblick/tree/main/packages/suite)

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

- **GitHub Issues**: [Lichtblick Repository](https://github.com/Lichtblick-Suite/lichtblick/issues)
- **Community**: [Lichtblick Discussions](https://github.com/Lichtblick-Suite/lichtblick/discussions)
- **Documentation**: [Official Docs](https://lichtblick.org/docs)
