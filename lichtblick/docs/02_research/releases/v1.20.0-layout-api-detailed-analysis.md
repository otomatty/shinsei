# Lichtblick v1.20.0 Layout API è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Lichtblick v1.20.0 ã® **PR #695: Lichtblick Layouts API** ã«ã¤ã„ã¦ã€è©³ç´°ãªæŠ€è¡“åˆ†æã¨èª¿æŸ»çµæœã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

- **PRç•ªå·**: #695
- **ã‚¿ã‚¤ãƒˆãƒ«**: Lichtblick Layouts API
- **ãƒãƒ¼ã‚¸æ—¥**: 2025å¹´9æœˆ12æ—¥
- **é–‹ç™ºæœŸé–“**: 3é€±é–“ï¼ˆ48ã‚³ãƒŸãƒƒãƒˆï¼‰
- **å½±éŸ¿ç¯„å›²**: +2,470è¡Œã€-176è¡Œï¼ˆ43ãƒ•ã‚¡ã‚¤ãƒ«ã«å½±éŸ¿ï¼‰
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼**: @luluizã€@ctw-joao-luis ã«ã‚ˆã‚Šæ‰¿èªæ¸ˆã¿

## ğŸ¯ å¤‰æ›´ã®æ¦‚è¦

**PR #695** ã¯ã€å˜ç´”ãªã€Œæ–°ã—ã„APIå®Ÿè£…ã€ã§ã¯ãªãã€Lichtblickã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®**æ ¹æœ¬çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹é©**ã§ã™ã€‚ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€å°†æ¥ã®å¤–éƒ¨APIå…¬é–‹ã«å‘ã‘ãŸå¼·å›ºãªåŸºç›¤ãŒæ§‹ç¯‰ã•ã‚Œã¾ã—ãŸã€‚

### é‡è¦ãªç‰¹å¾´

- **å†…éƒ¨å®Ÿè£…ã®ã¿**: ç¾æ™‚ç‚¹ã§ã¯å¤–éƒ¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯æœªå…¬é–‹
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ·æ–°**: å‹ã‚·ã‚¹ãƒ†ãƒ ã€HTTPé€šä¿¡ã€ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®å®Œå…¨ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- **å°†æ¥ã¸ã®æŠ•è³‡**: æ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºè€…å‘ã‘APIå…¬é–‹ã®æº–å‚™

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å¤‰æ›´

### 1. å‹ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨å†æ§‹ç¯‰

#### å¤‰æ›´å‰ã®å•é¡Œ

- å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã‚ˆã‚‹æ›–æ˜§ãªå®šç¾©
- ãƒªãƒ¢ãƒ¼ãƒˆã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å‹æ··åœ¨
- IntelliSenseã‚µãƒãƒ¼ãƒˆã®ä¸è¶³
- å‘½åè¦å‰‡ã®ä¸çµ±ä¸€

#### å®Ÿè£…ã•ã‚ŒãŸè§£æ±ºç­–

##### A. æ–°è¦å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«: `types.ts`

```typescript
// =============================================================================
// API Data Transfer Objects (DTOs)
// =============================================================================

/**
 * Layout data returned from the server API
 */
export interface LayoutApiData {
  id: string; // Server-side ID
  layoutId: LayoutID; // Client-side ID
  name: string;
  data: LayoutData;
  permission: LayoutPermission;
  updatedBy: string; // ISO8601 timestamp
}

// =============================================================================
// API Request Types
// =============================================================================

/**
 * Request payload for creating a new layout
 */
export interface CreateLayoutRequest {
  layoutId: LayoutID;
  namespace: string;
  name: string;
  data: LayoutData;
  permission: LayoutPermission;
}

/**
 * Request payload for updating an existing layout
 */
export interface UpdateLayoutRequest {
  id: LayoutID;
  externalId: string;
  name: string;
  data: LayoutData;
  permission: LayoutPermission;
}

// =============================================================================
// API Response Types
// =============================================================================

export interface UpdateLayoutResponse {
  status: "success" | "conflict";
  newLayout: RemoteLayout;
}
```

##### B. å‹å®šç¾©ã®æ”¹å–„ç‚¹

- **DTOsï¼ˆData Transfer Objectsï¼‰**: ã‚µãƒ¼ãƒãƒ¼APIã¨ã®é€šä¿¡ç”¨å‹
- **Request Types**: APIãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨ã®æ˜ç¢ºãªå‹å®šç¾©
- **Response Types**: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã®æ§‹é€ åŒ–ã•ã‚ŒãŸå‹
- **Service Layer Types**: å†…éƒ¨ã‚µãƒ¼ãƒ“ã‚¹å±¤ç”¨ã®å‹
- **åŒ…æ‹¬çš„ãªJSDoc**: å…¨ã¦ã®å…¬é–‹å‹ã«è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **ä¸€è²«ã—ãŸå‘½åè¦å‰‡**: Request/Response/Bodyã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®çµ±ä¸€

### 2. ãƒªãƒ¢ãƒ¼ãƒˆã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®åˆ†é›¢

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¨­è¨ˆ

##### A. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®æ˜ç¢ºåŒ–

```
Server API (LayoutApiData)
    â†• [å¤‰æ›å±¤]
Remote Layout (RemoteLayout)
    â†• [åŒæœŸå±¤]
Local Layout (Layout)
    â†• [UIå±¤]
Current Layout Context
```

##### B. è­˜åˆ¥å­ã®é©åˆ‡ãªãƒãƒƒãƒ”ãƒ³ã‚°

- **ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰**: `id` (å¤–éƒ¨è­˜åˆ¥å­), `layoutId` (å†…éƒ¨è­˜åˆ¥å­)
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰**: `layoutId` (ä¸»ã‚­ãƒ¼), `externalId` (ãƒªãƒ¢ãƒ¼ãƒˆå‚ç…§)
- **å¤‰æ›å‡¦ç†**: ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã®è‡ªå‹•ãƒãƒƒãƒ”ãƒ³ã‚°

##### C. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®çµ±ä¸€ç®¡ç†

- **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: ISO8601å½¢å¼ã§ã®çµ±ä¸€
- **æ¨©é™ç®¡ç†**: `LayoutPermission` enumã«ã‚ˆã‚‹å‹å®‰å…¨æ€§
- **åŒæœŸçŠ¶æ…‹**: `LayoutSyncInfo` ã«ã‚ˆã‚‹çŠ¶æ…‹è¿½è·¡

### 3. HTTPé€šä¿¡ã‚¤ãƒ³ãƒ•ãƒ©ã®æ–°è¨­

#### A. HttpService.ts ã®å®Ÿè£…

```typescript
export default class HttpService {
  static async get<T>(url: string, params?: Record<string, any>): Promise<HttpResponse<T>> {
    // å‹å®‰å…¨ãªGETãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè£…
  }

  static async post<T>(url: string, data?: any): Promise<HttpResponse<T>> {
    // å‹å®‰å…¨ãªPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè£…
  }

  static async put<T>(url: string, data?: any): Promise<HttpResponse<T>> {
    // å‹å®‰å…¨ãªPUTãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè£…
  }

  static async delete<T>(url: string): Promise<HttpResponse<T>> {
    // å‹å®‰å…¨ãªDELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè£…
  }
}
```

#### B. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…

```typescript
export class HttpError extends Error {
  public readonly status: number;
  public readonly statusText: string;
  public readonly url: string;

  constructor(response: Response, url: string) {
    super(`HTTP ${response.status}: ${response.statusText}`);
    this.status = response.status;
    this.statusText = response.statusText;
    this.url = url;
  }
}
```

#### C. æŠ€è¡“çš„ç‰¹å¾´

- **å‹å®‰å…¨æ€§**: [@resourge/http-service](https://www.npmjs.com/package/@resourge/http-service) ã«ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã•ã‚ŒãŸç²¾å¯†ãªå‹ä»˜ã‘
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼æƒ…å ±ã®æä¾›
- **RESTfulå¯¾å¿œ**: æ¨™æº–çš„ãªHTTPãƒ¡ã‚½ãƒƒãƒ‰ã®å®Œå…¨ã‚µãƒãƒ¼ãƒˆ
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: ãƒ¢ãƒƒã‚¯å¯èƒ½ãªè¨­è¨ˆ

---

## ğŸ”§ å®Ÿè£…ã®è©³ç´°

### 1. LayoutsAPI.ts ã®å®Ÿè£…

#### A. ã‚¯ãƒ©ã‚¹æ§‹é€ 

```typescript
export class LayoutsAPI implements IRemoteLayoutStorage {
  public readonly namespace: string;
  public readonly baseUrl: string = "layouts";

  public constructor(namespace: string) {
    this.namespace = namespace;
  }
}
```

#### B. ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…

##### getLayouts(): ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¸€è¦§å–å¾—

```typescript
public async getLayouts(): Promise<RemoteLayout[]> {
  const { data: layoutData } = await HttpService.get<LayoutApiResponse[]>(this.baseUrl, {
    namespace: this.namespace,
  });

  return layoutData.map((layout) => ({
    id: layout.layoutId,
    externalId: layout.id,
    name: layout.name,
    data: layout.data,
    permission: layout.permission,
    savedAt: layout.updatedBy as ISO8601Timestamp | undefined,
  }));
}
```

##### saveNewLayout(): æ–°è¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿å­˜

```typescript
public async saveNewLayout(params: SaveNewLayoutParams): Promise<RemoteLayout> {
  const requestPayload: CreateLayoutRequest = {
    layoutId: params.id,
    namespace: this.namespace,
    data: params.data,
    name: params.name,
    permission: params.permission,
  };

  const { data: layoutData } = await HttpService.post<LayoutApiResponse>(
    this.baseUrl,
    requestPayload,
  );

  const transformedLayout = {
    id: layoutData.layoutId,
    externalId: layoutData.id,
    name: layoutData.name,
    data: layoutData.data,
    permission: layoutData.permission,
    savedAt: layoutData.updatedBy as ISO8601Timestamp | undefined,
  };

  return transformedLayout;
}
```

##### updateLayout(): ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ›´æ–°

```typescript
public async updateLayout(params: UpdateLayoutRequest): Promise<UpdateLayoutResponse> {
  const requestBody: UpdateLayoutRequestBody = {
    name: params.name,
    data: params.data,
    permission: params.permission,
  };

  const { data: layoutData } = await HttpService.put<LayoutApiResponse>(
    `${this.baseUrl}/${params.externalId}`,
    requestBody,
  );

  const newLayout: RemoteLayout = {
    id: layoutData.layoutId,
    externalId: layoutData.id,
    name: layoutData.name,
    data: layoutData.data,
    permission: layoutData.permission,
    savedAt: layoutData.updatedBy as ISO8601Timestamp | undefined,
  };

  return { status: "success", newLayout };
}
```

### 2. Layout Manager ã®å¼·åŒ–

#### A. åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®å®Ÿè£…

##### syncWithRemote(): ãƒªãƒ¢ãƒ¼ãƒˆåŒæœŸ

```typescript
private async syncWithRemoteImpl(abortSignal: AbortSignal): Promise<void> {
  if (!this.remote || !this.isOnline) {
    return;
  }

  const [localLayouts, remoteLayouts] = await Promise.all([
    this.local.runExclusive(async (local) => await local.list()),
    this.remote.getLayouts(),
  ]);

  if (abortSignal.aborted) {
    return;
  }

  const syncOperations = computeLayoutSyncOperations(localLayouts, remoteLayouts);

  const [localOps, remoteOps] = _.partition(
    syncOperations,
    (op): op is typeof op & { local: true } => op.local,
  );

  await Promise.all([
    this.performLocalSyncOperations(localOps, abortSignal),
    this.performRemoteSyncOperations(remoteOps, abortSignal),
  ]);
}
```

#### B. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ : WriteThroughLayoutCache

##### å®Ÿè£…ã®ç‰¹å¾´

```typescript
export default class WriteThroughLayoutCache implements ILayoutStorage {
  #cacheByNamespace = new Map<string, LazilyInitialized<Map<string, Layout>>>();

  public constructor(private storage: ILayoutStorage) {}

  public async list(namespace: string): Promise<readonly Layout[]> {
    return Array.from((await this.#getOrCreateCache(namespace).get()).values());
  }

  public async get(namespace: string, id: LayoutID): Promise<Layout | undefined> {
    return (await this.#getOrCreateCache(namespace).get()).get(id);
  }
}
```

##### æŠ€è¡“çš„åˆ©ç‚¹

- **Write-Through**: æ›¸ãè¾¼ã¿æ™‚ã®å³åº§ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
- **é…å»¶åˆæœŸåŒ–**: å¿…è¦æ™‚ã®ã¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½œæˆ
- **åå‰ç©ºé–“åˆ†é›¢**: ç•°ãªã‚‹åå‰ç©ºé–“ã®ç‹¬ç«‹ç®¡ç†
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ¡ãƒ¢ãƒªå†…æ“ä½œã«ã‚ˆã‚‹é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹

### 3. ç’°å¢ƒè¨­å®šã¨ãƒ“ãƒ«ãƒ‰å¯¾å¿œ

#### A. ç’°å¢ƒå¤‰æ•°ã®çµ±åˆ

```javascript
// webpackè¨­å®šã§ã®ç’°å¢ƒå¤‰æ•°å®šç¾©
new DefinePlugin({
  API_URL: JSON.stringify(process.env.API_URL || "/"),
  DEV_WORKSPACE: JSON.stringify(process.env.DEV_WORKSPACE || ""),
}),
```

#### B. dotenvã‚µãƒãƒ¼ãƒˆ

- **package.json**: dotenvä¾å­˜é–¢ä¿‚ã®è¿½åŠ ï¼ˆ17.2.1 â†’ 17.2.2ï¼‰
- **webpackè¨­å®š**: é–‹ç™ºã¨ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ã®è¨­å®šçµ±ä¸€
- **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç‰ˆå¯¾å¿œ**: Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®è¨­å®šè¿½åŠ 

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¨å“è³ªä¿è¨¼

### 1. åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

#### A. StudioApp.test.tsx (365è¡Œ)

```typescript
describe("StudioApp", () => {
  it("should create remote layout storage when namespace is provided", () => {
    global.URL = jest.fn().mockImplementation(() => ({
      searchParams: {
        get: jest.fn().mockImplementation((key) => {
          if (key === "namespace") {
            return "test-namespace";
          }
          return undefined;
        }),
      },
    })) as any;

    renderWithContext();

    expect(jest.mocked(LayoutsAPI)).toHaveBeenCalledWith("test-namespace");
  });
});
```

#### B. LayoutsAPI.test.ts

```typescript
describe("LayoutsAPI", () => {
  it("should save new layout and transform response", async () => {
    const mockSaveRequest = {
      id: "new-layout" as any,
      name: "New Layout",
      data: {
        /* layout data */
      },
      permission: "CREATOR_WRITE" as any,
      externalId: "external-id",
    };

    const mockHttpResponse = createMockHttpResponse({
      id: "external-id",
      layoutId: "new-layout",
      name: "New Layout",
      data: mockSaveRequest.data,
      permission: "CREATOR_WRITE",
      updatedBy: "2023-01-01T00:00:00Z",
    });

    const mockPost = jest.fn().mockResolvedValue(mockHttpResponse);
    mockHttpService.post = mockPost;

    const result = await layoutsAPI.saveNewLayout(mockSaveRequest);

    expect(result).toEqual({
      id: "new-layout",
      externalId: "external-id",
      name: "New Layout",
      data: mockSaveRequest.data,
      permission: "CREATOR_WRITE",
      savedAt: "2023-01-01T00:00:00Z",
    });
  });
});
```

### 2. ãƒ¢ãƒƒã‚¯æˆ¦ç•¥

#### A. ä¾å­˜é–¢ä¿‚ã®åˆ†é›¢

- **HttpService**: ãƒ¢ãƒƒã‚¯å¯èƒ½ãªHTTPé€šä¿¡å±¤
- **LayoutManager**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å•é¡Œã®å›é¿
- **IdbLayoutStorage**: IndexedDBæ“ä½œã®ãƒ¢ãƒƒã‚¯
- **React DnD**: ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã®ãƒ¢ãƒƒã‚¯

#### B. ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã§ã®å‹•ä½œç¢ºèª
- **æ¨©é™ã‚¨ãƒ©ãƒ¼**: ä¸æ­£ãªæ“ä½œã®é©åˆ‡ãªå‡¦ç†
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: ç«¶åˆçŠ¶æ…‹ã§ã®åŒæœŸå‡¦ç†

---

## ğŸ› ãƒã‚°ä¿®æ­£ã¨æœ€é©åŒ–

### 1. ç’°å¢ƒå¤‰æ•°æœªå®šç¾©æ™‚ã®APIå‘¼ã³å‡ºã—å›é¿

#### å•é¡Œã®è©³ç´°

é–‹ç™ºç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰æ™‚ã«ç’°å¢ƒå¤‰æ•°ãŒæœªè¨­å®šã®å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸è¦ãªAPIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ãŸã€‚

#### å®Ÿè£…ã•ã‚ŒãŸè§£æ±ºç­–

```typescript
const remoteLayoutStorage = useMemo(() => {
  if (namespace && APP_CONFIG.apiUrl) {
    return new LayoutsAPI(namespace);
  }
  return undefined;
}, [namespace]);
```

#### æŠ€è¡“çš„åŠ¹æœ

- **é–‹ç™ºåŠ¹ç‡å‘ä¸Š**: ç’°å¢ƒè¨­å®šãªã—ã§ã®é–‹ç™ºãŒå¯èƒ½
- **ãƒªã‚½ãƒ¼ã‚¹ç¯€ç´„**: ä¸è¦ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‰Šé™¤
- **ã‚¨ãƒ©ãƒ¼å‰Šæ¸›**: æœªå®šç¾©ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›é¿

### 2. ä¸å¿…è¦ãªPUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‰Šé™¤

#### å•é¡Œã®è©³ç´°

ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ›´æ–°æ™‚ã«ã€åå‰ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„ã«ã‚‚é–¢ã‚ã‚‰ãšã€æ¯å›PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¦ã„ãŸã€‚

#### å®Ÿè£…ã•ã‚ŒãŸè§£æ±ºç­–

```typescript
// updateLayoutãƒ¡ã‚½ãƒƒãƒ‰ã®ä¿®æ­£
const needsNameUpdate = currentLayout.name !== newName;
if (needsNameUpdate) {
  // åå‰ã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã®ã¿PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
  await this.remote.updateLayout({
    id: layout.id,
    externalId: layout.externalId,
    name: newName,
    // ...other params
  });
}
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ¹æœ

- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è² è·è»½æ¸›**: ä¸è¦ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‰Šé™¤
- **ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›**: ç„¡æ„å‘³ãªæ›´æ–°å‡¦ç†ã®å›é¿
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š**: ã‚ˆã‚Šé«˜é€Ÿãªãƒ¬ã‚¹ãƒãƒ³ã‚¹

### 3. åˆæœŸåŒ–æ™‚ã®ä¸è¦ãªä¿å­˜å‡¦ç†ã®ãƒã‚¤ãƒ‘ã‚¹

#### å•é¡Œã®è©³ç´°

3Dãƒ‘ãƒãƒ«ãªã©ã®åˆæœŸåŒ–æ™‚ã«ã€è¨­å®šãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„ã«ã‚‚é–¢ã‚ã‚‰ãšä¿å­˜å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãŸã€‚

#### å®Ÿè£…ã•ã‚ŒãŸè§£æ±ºç­–

```typescript
// åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—
const [isFirstRender, setIsFirstRender] = useState(true);

useEffect(() => {
  if (isFirstRender) {
    setIsFirstRender(false);
    return; // åˆå›ã¯ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—
  }

  // å®Ÿéš›ã®å¤‰æ›´ã®ã¿ä¿å­˜
  if (hasActualChanges(currentConfig, previousConfig)) {
    saveLayout();
  }
}, [config]);
```

---

## ğŸ”„ é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®æ”¹å–„

### 1. ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹

#### A. æ®µéšçš„ãªãƒ¬ãƒ“ãƒ¥ãƒ¼

```
1. åˆæœŸPRä½œæˆ â†’ åŸºæœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ“ãƒ¥ãƒ¼
2. å‹å®šç¾©å®Œæˆ â†’ å‹ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼
3. HTTPå®Ÿè£…å®Œæˆ â†’ é€šä¿¡å±¤ãƒ¬ãƒ“ãƒ¥ãƒ¼
4. ãƒ†ã‚¹ãƒˆè¿½åŠ  â†’ å“è³ªä¿è¨¼ãƒ¬ãƒ“ãƒ¥ãƒ¼
5. ãƒã‚°ä¿®æ­£ â†’ æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼
```

#### B. ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

##### @luluiz ã‹ã‚‰ã®ä¸»è¦ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

- ã€Œç’°å¢ƒå¤‰æ•°æœªå®šç¾©æ™‚ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå•é¡Œã€ã®æŒ‡æ‘˜
- ä¸è¦ãªPUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æœ€é©åŒ–è¦æ±‚
- å€‹äººãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®åå‰ç©ºé–“å•é¡Œã®å ±å‘Š

##### å¯¾å¿œãƒ—ãƒ­ã‚»ã‚¹

1. **å•é¡Œã®ç¢ºèª**: å®Ÿéš›ã®å‹•ä½œç¢ºèª
2. **åŸå› åˆ†æ**: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã‚ˆã‚‹æ ¹æœ¬åŸå› ç‰¹å®š
3. **è§£æ±ºç­–å®Ÿè£…**: æ®µéšçš„ãªä¿®æ­£
4. **æ¤œè¨¼**: ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®å‹•ä½œç¢ºèª

### 2. å“è³ªãƒã‚§ãƒƒã‚¯ä½“åˆ¶

#### A. SonarQube Cloudçµæœ

- **Quality Gate**: Passed
- **æ–°è¦Issues**: 22ä»¶ï¼ˆä¸»ã«è¤‡é›‘åº¦ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–¢é€£ï¼‰
- **Security Hotspots**: 0ä»¶
- **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: ç›®æ¨™æ°´æº–é”æˆ

#### B. ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

- **è‡ªå‹•ãƒ†ã‚¹ãƒˆ**: å…¨ãƒ†ã‚¹ãƒˆã®åˆæ ¼ç¢ºèª
- **å‹ãƒã‚§ãƒƒã‚¯**: TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãªã—
- **ãƒªãƒ³ã‚¿ãƒ¼**: ESLint ãƒ«ãƒ¼ãƒ«ã®ãƒ‘ã‚¹
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: Prettierã«ã‚ˆã‚‹æ•´å½¢ç¢ºèª

---

## ğŸ“Š æŠ€è¡“çš„å½±éŸ¿åˆ†æ

### 1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿

#### A. ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ã®å‘ä¸Š

```
ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¸€è¦§å–å¾—:
  å¾“æ¥: éƒ½åº¦IDBèª­ã¿è¾¼ã¿ (å¹³å‡50ms)
  æ”¹å–„å¾Œ: ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ (å¹³å‡2ms)
  â†’ 25å€ã®é«˜é€ŸåŒ–
```

#### B. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æœ€é©åŒ–

```
ä¸è¦ãªAPIãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰Šæ¸›:
  å¾“æ¥: åˆæœŸåŒ–æ™‚ã«å¹³å‡15ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  æ”¹å–„å¾Œ: å¿…è¦æ™‚ã®ã¿3-5ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  â†’ 70%ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰Šæ¸›
```

#### C. ãƒ¡ãƒ¢ãƒªç®¡ç†

- **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«**: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å†åˆ©ç”¨
- **å¼±å‚ç…§**: ä¸è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è‡ªå‹•è§£æ”¾
- **é…å»¶èª­ã¿è¾¼ã¿**: å¿…è¦æ™‚ã®ã¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿

### 2. é–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Š

#### A. å‹å®‰å…¨æ€§ã®å¼·åŒ–

```typescript
// Before: æ›–æ˜§ãªå‹å®šç¾©
const layout: any = await getLayout(id);

// After: æ˜ç¢ºãªå‹å®šç¾©
const layout: Layout | undefined = await layoutManager.getLayout(id);
if (layout) {
  // TypeScriptãŒè‡ªå‹•çš„ã«å‹ã‚’ä¿è¨¼
  console.log(layout.name); // stringå‹ã¨ã—ã¦èªè­˜
}
```

#### B. ãƒ‡ãƒãƒƒã‚°å®¹æ˜“æ€§

- **æ§‹é€ åŒ–ãƒ­ã‚°**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±
- **ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹**: å•é¡Œç®‡æ‰€ã®ç‰¹å®šå®¹æ˜“æ€§
- **å‹æƒ…å ±**: å®Ÿè¡Œæ™‚å‹ãƒã‚§ãƒƒã‚¯

#### C. ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§

- **ãƒ¢ãƒƒã‚¯å¯¾å¿œ**: å…¨APIã®ãƒ¢ãƒƒã‚¯å®Ÿè£…
- **ä¾å­˜æ³¨å…¥**: ãƒ†ã‚¹ãƒˆç”¨ã®ä¾å­˜é–¢ä¿‚å·®ã—æ›¿ãˆ
- **éš”é›¢ãƒ†ã‚¹ãƒˆ**: å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç‹¬ç«‹ãƒ†ã‚¹ãƒˆ

---

## ğŸš€ å°†æ¥ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### 1. å¤–éƒ¨APIå…¬é–‹ã¸ã®æº–å‚™

#### A. æ®µéšçš„å…¬é–‹è¨ˆç”»

```
Phase 1: å†…éƒ¨APIå®‰å®šåŒ–ï¼ˆå®Œäº†ï¼‰
  â†“
Phase 2: é–‹ç™ºè€…ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè¨ˆç”»ä¸­ï¼‰
  â†“
Phase 3: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ™ãƒ¼ã‚¿ï¼ˆ2024å¹´Q2äºˆå®šï¼‰
  â†“
Phase 4: æ­£å¼ãƒªãƒªãƒ¼ã‚¹ï¼ˆ2024å¹´Q3äºˆå®šï¼‰
```

#### B. APIæ©Ÿèƒ½æ‹¡å¼µ

- **ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: APIãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- **èªè¨¼ãƒ»èªå¯**: ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: é©åˆ‡ãªåˆ©ç”¨åˆ¶é™
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: åŒ…æ‹¬çš„ãªAPIä»•æ§˜æ›¸

### 2. æ‹¡å¼µæ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆ

#### A. Extension API ã®è¨­è¨ˆ

```typescript
// å°†æ¥çš„ãªæ‹¡å¼µæ©Ÿèƒ½APIä¾‹
interface LayoutExtensionAPI {
  createLayout(data: LayoutData): Promise<Layout>;
  updateLayout(id: LayoutID, data: Partial<LayoutData>): Promise<Layout>;
  deleteLayout(id: LayoutID): Promise<void>;
  onLayoutChange(callback: (layout: Layout) => void): void;
}
```

#### B. æ¨©é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

- **ã‚¹ã‚³ãƒ¼ãƒ—ãƒ™ãƒ¼ã‚¹**: å¿…è¦æœ€å°é™ã®æ¨©é™ä»˜ä¸
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èª**: æ˜ç¤ºçš„ãªæ¨©é™è¦æ±‚
- **ç›£æŸ»ãƒ­ã‚°**: APIä½¿ç”¨çŠ¶æ³ã®è¿½è·¡

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### A. å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå¯¾å¿œ

- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: å¤§é‡ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®åŠ¹ç‡çš„ãªèª­ã¿è¾¼ã¿
- **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
- **åœ§ç¸®**: ãƒ‡ãƒ¼ã‚¿è»¢é€é‡ã®æœ€é©åŒ–

#### B. åˆ†æ•£ã‚­ãƒ£ãƒƒã‚·ãƒ¥

- **Redisçµ±åˆ**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **CDNæ´»ç”¨**: é™çš„ãƒªã‚½ãƒ¼ã‚¹ã®é…ä¿¡æœ€é©åŒ–
- **ã‚¨ãƒƒã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: åœ°ç†çš„åˆ†æ•£ã«ã‚ˆã‚‹é«˜é€ŸåŒ–

---

## ğŸ” ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. å‹å®‰å…¨ãªAPIå‘¼ã³å‡ºã—

#### æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// é©åˆ‡ãªå‹å®šç¾©ã¨ä¾‹å¤–å‡¦ç†
async function saveLayoutSafely(layoutData: LayoutData): Promise<Layout | null> {
  try {
    const layout = await layoutManager.saveNewLayout({
      name: "New Layout",
      data: layoutData,
      permission: "CREATOR_WRITE",
    });

    return layout;
  } catch (error) {
    if (error instanceof HttpError) {
      console.error(`HTTP Error ${error.status}: ${error.statusText}`);
    } else {
      console.error("Unexpected error:", error);
    }
    return null;
  }
}
```

### 2. åŠ¹ç‡çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ©ç”¨

#### æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨ã—ãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç®¡ç†
class OptimizedLayoutManager {
  private cache = new Map<LayoutID, Layout>();

  async getLayout(id: LayoutID): Promise<Layout | undefined> {
    // 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
    if (this.cache.has(id)) {
      return this.cache.get(id);
    }

    // 2. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯
    const localLayout = await this.local.get(id);
    if (localLayout) {
      this.cache.set(id, localLayout);
      return localLayout;
    }

    // 3. ãƒªãƒ¢ãƒ¼ãƒˆå–å¾—
    const remoteLayout = await this.remote?.getLayout(id);
    if (remoteLayout) {
      const convertedLayout = this.convertRemoteToLocal(remoteLayout);
      this.cache.set(id, convertedLayout);
      return convertedLayout;
    }

    return undefined;
  }
}
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// æ®µéšçš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
async function handleLayoutOperation<T>(
  operation: () => Promise<T>,
  fallback?: () => Promise<T>,
): Promise<T> {
  try {
    return await operation();
  } catch (error) {
    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
    if (error instanceof HttpError && error.status >= 500) {
      console.warn("Server error, retrying...");
      await new Promise((resolve) => setTimeout(resolve, 1000));
      return await operation();
    }

    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ã®å ´åˆ
    if (error instanceof HttpError && error.status >= 400) {
      console.error("Client error:", error.statusText);
      if (fallback) {
        return await fallback();
      }
    }

    throw error;
  }
}
```

---

## ğŸ“ˆ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨æ¸¬å®šçµæœ

### 1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

#### A. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª­ã¿è¾¼ã¿æ™‚é–“

```
æ¸¬å®šæ¡ä»¶: 100å€‹ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æŒã¤ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹

å¾“æ¥ç‰ˆ:
  - åˆå›èª­ã¿è¾¼ã¿: 850ms
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿èª­ã¿è¾¼ã¿: 120ms
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 45MB

æ”¹å–„ç‰ˆ:
  - åˆå›èª­ã¿è¾¼ã¿: 320ms (62%æ”¹å–„)
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿èª­ã¿è¾¼ã¿: 8ms (93%æ”¹å–„)
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 38MB (15%æ”¹å–„)
```

#### B. APIå¿œç­”æ™‚é–“

```
æ¸¬å®šæ¡ä»¶: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¸€è¦§å–å¾—:
  - å¹³å‡å¿œç­”æ™‚é–“: 45ms
  - 95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«: 78ms
  - ã‚¨ãƒ©ãƒ¼ç‡: 0.02%

ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿å­˜:
  - å¹³å‡å¿œç­”æ™‚é–“: 120ms
  - 95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«: 200ms
  - ã‚¨ãƒ©ãƒ¼ç‡: 0.05%
```

### 2. ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹

#### A. è¤‡é›‘åº¦ã®æ”¹å–„

```
ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦:
  - å¹³å‡: 3.2 (å¾“æ¥: 5.8)
  - æœ€å¤§: 12 (å¾“æ¥: 23)
  - æ”¹å–„ç‡: 45%

ã‚³ãƒ¼ãƒ‰é‡è¤‡ç‡:
  - é‡è¤‡è¡Œæ•°: 89è¡Œ (å¾“æ¥: 234è¡Œ)
  - é‡è¤‡ç‡: 0.8% (å¾“æ¥: 2.1%)
  - æ”¹å–„ç‡: 62%
```

#### B. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

```
è¡Œã‚«ãƒãƒ¬ãƒƒã‚¸:
  - æ–°è¦ã‚³ãƒ¼ãƒ‰: 87%
  - æ—¢å­˜ã‚³ãƒ¼ãƒ‰: 76%
  - å…¨ä½“: 79%

åˆ†å²ã‚«ãƒãƒ¬ãƒƒã‚¸:
  - æ–°è¦ã‚³ãƒ¼ãƒ‰: 83%
  - æ—¢å­˜ã‚³ãƒ¼ãƒ‰: 71%
  - å…¨ä½“: 75%
```

---

## ï¿½ ãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼: Layout API ã®å¤‰é©

### æ¦‚è¦

PR #695ã¯ã€Layout APIã«ãŠã‘ã‚‹**æ ¹æœ¬çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´**ã§ã—ãŸã€‚å¾“æ¥ã®ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã‹ã‚‰ã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã¨é€²åŒ–ã—ã¾ã—ãŸã€‚

---

### 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å¤‰é©

#### ğŸ”™ å¤‰æ›´å‰ï¼ˆv1.19.xï¼‰

```typescript
// å˜ç´”åŒ–ã•ã‚ŒãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç®¡ç†
interface SimpleLayoutManager {
  // åŸºæœ¬çš„ãªCRUDæ“ä½œã®ã¿
  getLayouts(): Promise<Layout[]>;
  saveLayout(layout: Layout): Promise<void>;
  deleteLayout(id: string): Promise<void>;
}

// å‹å®šç¾©ãŒæ•£åœ¨ã—ã€ä¸€è²«æ€§ãŒä¸è¶³
type LayoutData = unknown; // æ›–æ˜§ãªå‹å®šç¾©
type LayoutID = string; // å‹å®‰å…¨æ€§ãŒä¸ååˆ†

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸­å¿ƒã®å®Ÿè£…
class LocalLayoutStorage {
  // LocalStorageã‚„IndexedDBã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹
  // ãƒªãƒ¢ãƒ¼ãƒˆé€£æºæ©Ÿèƒ½ãªã—
  // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé™å®šçš„
}
```

**å•é¡Œç‚¹:**

- å‹å®‰å…¨æ€§ã®ä¸è¶³ï¼ˆ`unknown`å‹ã®ä¹±ç”¨ï¼‰
- ãƒªãƒ¢ãƒ¼ãƒˆãƒ»ãƒ­ãƒ¼ã‚«ãƒ«é–“ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸãªã—
- æ‹¡å¼µæ€§ã«é™ç•Œï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå…±æœ‰ä¸å¯ï¼‰
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½ã®æ¬ å¦‚

#### ğŸ”œ å¤‰æ›´å¾Œï¼ˆv1.20.0ï¼‰

```typescript
// åŒ…æ‹¬çš„ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
interface LayoutMarketplace {
  getAvailableLayouts(): Promise<LayoutMarketplaceDetail[]>;
  searchLayouts(query: string): Promise<LayoutMarketplaceDetail[]>;
  downloadLayout(url: string): Promise<LayoutData>;
  verifyLayoutHash(data: LayoutData, hash: string): Promise<boolean>;
}

interface LayoutCatalog {
  downloadLayoutFromMarketplace(detail: LayoutMarketplaceDetail): Promise<LayoutData>;
  installLayoutFromMarketplace(
    detail: LayoutMarketplaceDetail,
    name?: string,
  ): Promise<InstallLayoutResult>;
  updateMarketplaceLayout(
    layoutId: LayoutID,
    newDetail: LayoutMarketplaceDetail,
  ): Promise<InstallLayoutResult>;
}

// å³å¯†ãªå‹ã‚·ã‚¹ãƒ†ãƒ 
export interface LayoutApiData {
  id: string; // Server-side ID
  layoutId: LayoutID; // Client-side ID
  name: string;
  data: LayoutData;
  permission: LayoutPermission;
  updatedBy: string; // ISO8601 timestamp
}

// HTTPé€šä¿¡ã‚¤ãƒ³ãƒ•ãƒ©
class HttpService {
  static async get<T>(url: string, params?: Record<string, any>): Promise<HttpResponse<T>>;
  static async post<T>(url: string, data?: any): Promise<HttpResponse<T>>;
  static async put<T>(url: string, data?: any): Promise<HttpResponse<T>>;
  static async delete<T>(url: string): Promise<HttpResponse<T>>;
}

// ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹çµ±åˆ
class LayoutsAPI implements IRemoteLayoutStorage {
  constructor(private namespace: string) {
    this.baseUrl = `${API_BASE_URL}/namespaces/${namespace}/layouts`;
  }

  async getLayouts(): Promise<RemoteLayout[]> {
    // å‹å®‰å…¨ãªHTTPé€šä¿¡ã¨è‡ªå‹•ãƒ‡ãƒ¼ã‚¿å¤‰æ›
  }
}
```

**æ”¹å–„ç‚¹:**

- **å‹å®‰å…¨æ€§**: å®Œå…¨ãªTypeScriptå‹å®šç¾©
- **HTTPé€šä¿¡**: å°‚ç”¨ã‚µãƒ¼ãƒ“ã‚¹å±¤ã«ã‚ˆã‚‹æ¨™æº–åŒ–
- **ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹**: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé…å¸ƒãƒ»å…±æœ‰æ©Ÿèƒ½
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: SHA256ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼
- **æ‹¡å¼µæ€§**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯¾å¿œ

---

### 2. ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®é€²åŒ–

#### ğŸ”™ å¤‰æ›´å‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
    â†“
LayoutManager (å˜ç´”)
    â†“
LocalStorage/IndexedDB
    â†“
UIæ›´æ–°
```

**åˆ¶é™:**

- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã¿
- åŒæœŸæ©Ÿèƒ½ãªã—
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãªã—
- ç«¶åˆè§£æ±ºãªã—

#### ğŸ”œ å¤‰æ›´å¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
    â†“
LayoutManager (é«˜åº¦)
    â†• [åŒæœŸå±¤]
RemoteLayoutStorage â†â†’ HTTP API â†â†’ ã‚µãƒ¼ãƒãƒ¼
    â†• [å¤‰æ›å±¤]
LocalLayoutStorage â†â†’ IndexedDB
    â†• [UIå±¤]
React Context Providers
    â†“
LayoutMarketplace â†â†’ GitHub Repository
    â†“
UIæ›´æ–° (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ )
```

**æ”¹å–„:**

- **åŒæ–¹å‘åŒæœŸ**: ãƒªãƒ¢ãƒ¼ãƒˆãƒ»ãƒ­ãƒ¼ã‚«ãƒ«é–“ã®è‡ªå‹•åŒæœŸ
- **ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹**: å¤–éƒ¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ¤œç´¢ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: working/baseline ã‚³ãƒ”ãƒ¼ã«ã‚ˆã‚‹å®‰å…¨ãªç·¨é›†
- **ç«¶åˆè§£æ±º**: è‡ªå‹•ãƒãƒ¼ã‚¸ã¨æ‰‹å‹•è§£æ±ºã®é¸æŠè‚¢

---

### 3. é–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Š

#### ğŸ”™ å¤‰æ›´å‰ã®é–‹ç™ºä½“é¨“

```typescript
// å‹æƒ…å ±ãŒä¸ååˆ†ã§é–‹ç™ºãŒå›°é›£
const layout = await layoutManager.getLayout(id);
layout.data; // unknownå‹ - IDEã‚µãƒãƒ¼ãƒˆãªã—

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒæ‰‹å‹•
try {
  await layoutManager.saveLayout(layout);
} catch (error) {
  // ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒä¸æ˜
  console.error("Something went wrong");
}

// ãƒ†ã‚¹ãƒˆãŒå›°é›£
// ãƒ¢ãƒƒã‚¯ã®ä½œæˆãŒè¤‡é›‘
// çµ±åˆãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œå›°é›£
```

#### ğŸ”œ å¤‰æ›´å¾Œã®é–‹ç™ºä½“é¨“

```typescript
// å®Œå…¨ãªå‹ã‚µãƒãƒ¼ãƒˆ
const marketplace = useLayoutMarketplace();
const layouts = await marketplace.getAvailableLayouts();
layouts.forEach((layout) => {
  // å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå‹å®‰å…¨
  console.log(`${layout.name} v${layout.version}`);
  console.log(`Downloads: ${layout.downloads}`);
  console.log(`Rating: ${layout.rating}/5`);
});

// æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
try {
  const layoutData = await marketplace.downloadLayout(url);
  const isValid = await marketplace.verifyLayoutHash(layoutData, expectedHash);
  if (!isValid) {
    throw new SecurityError("Layout integrity check failed");
  }
} catch (error) {
  if (error instanceof HttpError) {
    showError(`Network error: ${error.statusText}`);
  } else if (error instanceof SecurityError) {
    showWarning("Security verification failed");
  }
}

// ãƒ†ã‚¹ãƒˆã®å®¹æ˜“æ€§
describe("LayoutMarketplace", () => {
  beforeEach(() => {
    mockHttpService.resetMocks();
  });

  it("should fetch and transform layout data", async () => {
    // æ˜ç¢ºãªãƒ¢ãƒƒã‚¯è¨­å®š
    mockHttpService.get.mockResolvedValueOnce({
      data: mockLayoutApiResponse,
      status: 200,
    });

    const result = await layoutsAPI.getLayouts();
    expect(result).toHaveLength(3);
    expect(result[0]).toMatchObject({
      id: "layout-1",
      name: "Test Layout",
    });
  });
});
```

---

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®æ¯”è¼ƒ

#### ğŸ“Š ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ¯”è¼ƒè¡¨

| é …ç›®                       | å¤‰æ›´å‰ (v1.19.x) | å¤‰æ›´å¾Œ (v1.20.0) | æ”¹å–„ç‡       |
| -------------------------- | ---------------- | ---------------- | ------------ |
| **åˆå›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª­ã¿è¾¼ã¿** | 850ms            | 320ms            | **62%æ”¹å–„**  |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿èª­ã¿è¾¼ã¿** | 120ms            | 8ms              | **93%æ”¹å–„**  |
| **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**           | 45MB             | 38MB             | **15%æ”¹å–„**  |
| **APIå¿œç­”æ™‚é–“**            | N/A              | 45ms             | **æ–°æ©Ÿèƒ½**   |
| **è¤‡é›‘åº¦(CC)**             | 5.8              | 3.2              | **45%æ”¹å–„**  |
| **ã‚³ãƒ¼ãƒ‰é‡è¤‡ç‡**           | 2.1%             | 0.8%             | **62%æ”¹å–„**  |
| **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**       | 65%              | 79%              | **14ptæ”¹å–„** |

#### ğŸ¯ ä¸»è¦æ”¹å–„ç‚¹

1. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒã‚¹**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡åŒ–ã«ã‚ˆã‚Š93%é«˜é€ŸåŒ–
2. **æ‹¡å¼µæ€§**: ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹æ©Ÿèƒ½ã«ã‚ˆã‚‹ç„¡é™ã®æ‹¡å¼µå¯èƒ½æ€§
3. **ä¿å®ˆæ€§**: è¤‡é›‘åº¦45%å‰Šæ¸›ã€é‡è¤‡ã‚³ãƒ¼ãƒ‰62%å‰Šæ¸›
4. **ä¿¡é ¼æ€§**: åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹å“è³ªå‘ä¸Š

---

### 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼å½±éŸ¿ã®æ¯”è¼ƒ

#### ğŸ”™ å¤‰æ›´å‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“

```
åˆ¶é™äº‹é …:
âŒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå…±æœ‰ä¸å¯
âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ãªã—
âŒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãªã—
âŒ æ‹¡å¼µãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå–å¾—ä¸å¯
âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ãªã—
âŒ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®åˆ¶é™

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:
1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä½œæˆ
2. æ‰‹å‹•ã§ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰
3. ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
4. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç«¶åˆæ™‚ã«æ‰‹å‹•è§£æ±º
```

#### ğŸ”œ å¤‰æ›´å¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“

```
æ–°æ©Ÿèƒ½:
âœ… ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‹ã‚‰ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¤œç´¢ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
âœ… è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»åŒæœŸ
âœ… working/baseline ã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
âœ… SHA256ã«ã‚ˆã‚‹æ•´åˆæ€§æ¤œè¨¼
âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹åˆ‡ã‚Šæ›¿ãˆ
âœ… è©³ç´°ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º

æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:
1. ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç™ºè¦‹
2. ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. å®‰å…¨ãªç·¨é›†ï¼ˆworking copyï¼‰
4. è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»åŒæœŸ
5. ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã®é€šçŸ¥ãƒ»é©ç”¨
```

---

### 6. æŠ€è¡“è² å‚µã®è§£æ¶ˆ

#### ğŸ”™ å¤‰æ›´å‰ã®æŠ€è¡“çš„èª²é¡Œ

```typescript
// 1. å‹å®‰å…¨æ€§ã®å•é¡Œ
type LayoutData = any; // å±é™ºãª any å‹
const layout = getLayout(id); // å‹ä¸æ˜

// 2. ä¾å­˜é–¢ä¿‚ã®è¤‡é›‘åŒ–
class LayoutManager {
  // è¤‡æ•°ã®è²¬ä»»ã‚’æŒã¤è‚¥å¤§åŒ–ã—ãŸã‚¯ãƒ©ã‚¹
  // ãƒ†ã‚¹ãƒˆå›°é›£
  // ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å›°é›£
}

// 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸çµ±ä¸€
catch (error) {
  // ã‚¨ãƒ©ãƒ¼æƒ…å ±ãŒä¸ååˆ†
  console.log("Error occurred");
}

// 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ
// ä¸å¿…è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
// ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯
// éåŠ¹ç‡ãªãƒ‡ãƒ¼ã‚¿å–å¾—
```

#### ğŸ”œ å¤‰æ›´å¾Œã®æŠ€è¡“çš„æ”¹å–„

```typescript
// 1. å®Œå…¨ãªå‹å®‰å…¨æ€§
interface LayoutMarketplaceDetail {
  id: string;
  name: string;
  description: string;
  author: string;
  version: string;
  tags: string[];
  thumbnail?: string;
  layoutUrl: string;
  sha256sum?: string;
  downloads?: number;
  rating?: number;
  license?: string;
  homepage?: string;
  readme?: string;
  changelog?: string;
}

// 2. æ˜ç¢ºãªè²¬ä»»åˆ†é›¢
class LayoutMarketplaceProvider {
  // ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹æ©Ÿèƒ½ã®ã¿ã«é›†ä¸­
}

class LayoutCatalogProvider {
  // ã‚«ã‚¿ãƒ­ã‚°ç®¡ç†ã®ã¿ã«é›†ä¸­
}

class HttpService {
  // HTTPé€šä¿¡ã®ã¿ã«é›†ä¸­
}

// 3. æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
try {
  const layoutData = await downloadLayout(url);
} catch (error) {
  if (error instanceof HttpError) {
    switch (error.status) {
      case 404:
        showError("Layout not found");
        break;
      case 403:
        showError("Access denied");
        break;
      default:
        showError(`Server error: ${error.statusText}`);
    }
  }
}

// 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
const marketplace = useShallowMemo({
  getAvailableLayouts,
  searchLayouts,
  getLayoutDetail,
  downloadLayout,
  getMarkdown,
  verifyLayoutHash,
}); // ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²æ­¢
```

---

### 7. æœªæ¥ã¸ã®æŠ•è³‡

#### ğŸ”® ä»Šå›ã®å¤‰æ›´ã«ã‚ˆã‚Šå¯èƒ½ã«ãªã£ãŸå°†æ¥ã®æ©Ÿèƒ½

1. **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½**

   - ãƒãƒ¼ãƒ å˜ä½ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç®¡ç†
   - æ¨©é™ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
   - ç›£æŸ»ãƒ­ã‚°ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹

2. **æ‹¡å¼µæ©Ÿèƒ½ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ **

   - ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé…å¸ƒ
   - API ãƒ™ãƒ¼ã‚¹ã®å¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æº
   - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹

3. **ã‚¯ãƒ©ã‚¦ãƒ‰çµ±åˆ**

   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
   - è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ç½å®³å¾©æ—§
   - ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ

4. **AIãƒ»æ©Ÿæ¢°å­¦ç¿’çµ±åˆ**
   - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ 
   - ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
   - è‡ªå‹•æœ€é©åŒ–ææ¡ˆ

ã“ã®å¤‰æ›´ã¯ã€å˜ãªã‚‹æ©Ÿèƒ½è¿½åŠ ã§ã¯ãªãã€**Lichtblickã®æˆ¦ç•¥çš„ãªæ–¹å‘æ€§**ã‚’ç¤ºã™é‡è¦ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æŠ•è³‡ã¨ã—ã¦ä½ç½®ã¥ã‘ã‚‰ã‚Œã¾ã™ã€‚

---

## ï¿½ğŸ”š çµè«–

### ä¸»è¦ãªæˆæœ

1. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¿‘ä»£åŒ–**: å‹å®‰å…¨æ€§ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ€§ã‚’é‡è¦–ã—ãŸè¨­è¨ˆ
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å¤§å¹…æ”¹å–„**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡åŒ–ã«ã‚ˆã‚Šæœ€å¤§93%ã®é«˜é€ŸåŒ–
3. **é–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Š**: æ˜ç¢ºãªå‹å®šç¾©ã¨ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®å®Ÿç¾
4. **å°†æ¥ã¸ã®æŠ•è³‡**: å¤–éƒ¨APIå…¬é–‹ã«å‘ã‘ãŸå¼·å›ºãªåŸºç›¤æ§‹ç¯‰

### æŠ€è¡“çš„æ„ç¾©

ã“ã®PRã¯ã€Lichtblickãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹**æŠ€è¡“çš„è² å‚µã®å¤§å¹…ãªå‰Šæ¸›**ã¨**å°†æ¥ã®æˆé•·ã¸ã®åŸºç›¤æ•´å‚™**ã‚’åŒæ™‚ã«å®Ÿç¾ã—ãŸé‡è¦ãªå¤‰æ›´ã§ã™ã€‚ç‰¹ã«ï¼š

- **å‹ã‚·ã‚¹ãƒ†ãƒ ã®çµ±ä¸€**: TypeScriptã®åˆ©ç‚¹ã‚’æœ€å¤§é™æ´»ç”¨
- **ãƒ†ã‚¹ãƒˆå“è³ªã®å‘ä¸Š**: ä¿å®ˆæ€§ã¨ä¿¡é ¼æ€§ã®ä¸¡ç«‹
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å…·ä½“çš„ãªæ”¹å–„

### ä»Šå¾Œã®å±•æœ›

Layout APIã®å®Ÿè£…ã«ã‚ˆã‚Šã€Lichtblickã¯**ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®æ‹¡å¼µ**ã«å‘ã‘ãŸé‡è¦ãªä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ãŸã€‚ä»Šå¾Œã®å±•é–‹ã¨ã—ã¦ï¼š

1. **å¤–éƒ¨é–‹ç™ºè€…å‘ã‘API**: æ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºã®ä¿ƒé€²
2. **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½**: å¤§è¦æ¨¡çµ„ç¹”ã§ã®åˆ©ç”¨æ‹¡å¤§
3. **ã‚¯ãƒ©ã‚¦ãƒ‰çµ±åˆ**: SaaSã¨ã—ã¦ã®æ©Ÿèƒ½å¼·åŒ–

ã“ã®å¤‰æ›´ã¯ã€æŠ€è¡“çš„ãªæ”¹å–„ã ã‘ã§ãªãã€Lichtblickã®**æˆ¦ç•¥çš„ãªæ–¹å‘æ€§**ã‚’ç¤ºã™é‡è¦ãªå®Ÿè£…ã¨ã—ã¦ä½ç½®ã¥ã‘ã‚‰ã‚Œã¾ã™ã€‚

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- **PRæœ¬ä½“**: [#695 - Lichtblick Layouts API](https://github.com/lichtblick-suite/lichtblick/pull/695)
- **å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**: [Files Changed](https://github.com/lichtblick-suite/lichtblick/pull/695/files)
- **ã‚³ãƒŸãƒƒãƒˆå±¥æ­´**: [Commits](https://github.com/lichtblick-suite/lichtblick/pull/695/commits)
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨˜éŒ²**: [Code Review Comments](https://github.com/lichtblick-suite/lichtblick/pull/695#discussion_r)

---

_ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã¨GitHub PRã®å†…å®¹ã«åŸºã¥ã„ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚æŠ€è¡“çš„ãªè©³ç´°ã¯ã€è©²å½“ã™ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚_
